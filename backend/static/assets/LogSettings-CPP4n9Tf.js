import{R as a,t as e,q as l,y as s,O as t,G as n,E as o,K as i}from"./elementPlus-DW6qdM9Z.js";import{o as c,_ as d}from"./index-D9Oaf6TO.js";import{v as u,k as r,D as y,M as p,a6 as g,R as m,E as v,F as b,r as k,c as f,ac as h,l as C,y as L,G as w,U as _,S as D,I as E,z as V,Q as O,u as x}from"./vendor-DDTA3iPl.js";const A={class:"log-settings-page"},I={key:0,class:"stat-row"},U={class:"stat-value"},j={class:"stat-label"},H={key:0,class:"stat-sub"},P={class:"card-header-row"},R={class:"header-actions"},S={class:"retention-grid"},T={class:"retention-header"},G={class:"retention-label"},q={class:"retention-body"},z={class:"retention-hint"},F={class:"auto-clean-section"},K=d(u({__name:"LogSettings",setup(d){const u=k(!1),K=k(!1),M=k(null),N=C({loginLogDays:90,operationLogDays:90,syncLogDays:90,apiAccessLogDays:30,securityEventDays:180,alertLogDays:90,autoCleanEnabled:!0,autoCleanTime:"03:00"}),Q=[{key:"loginLogDays",label:"登录日志",icon:a,iconClass:"icon-primary",hint:"用户登录/退出记录"},{key:"operationLogDays",label:"操作日志",icon:e,iconClass:"icon-success",hint:"用户和管理员操作记录"},{key:"syncLogDays",label:"同步日志",icon:l,iconClass:"icon-warning",hint:"上下游数据同步记录"},{key:"apiAccessLogDays",label:"API调用日志",icon:s,iconClass:"icon-info",hint:"OpenAPI 调用明细"},{key:"securityEventDays",label:"安全事件",icon:t,iconClass:"icon-error",hint:"异常登录、暴力破解等安全事件"},{key:"alertLogDays",label:"告警日志",icon:n,iconClass:"icon-error",hint:"告警通知发送记录"}],B=f(()=>{if(!M.value)return[];const a=M.value;return[{key:"login",label:"登录日志",count:a.loginLogCount||0,oldest:a.loginLogOldest},{key:"operation",label:"操作日志",count:a.operationLogCount||0,oldest:a.operationLogOldest},{key:"sync",label:"同步日志",count:a.syncLogCount||0,oldest:a.syncLogOldest},{key:"api",label:"API日志",count:a.apiAccessLogCount||0,oldest:a.apiAccessLogOldest},{key:"security",label:"安全事件",count:a.securityEventCount||0,oldest:a.securityEventOldest},{key:"alert",label:"告警日志",count:a.alertLogCount||0,oldest:a.alertLogOldest}]}),J=async()=>{var a;try{const e=await c.retentionStats();M.value=(null==(a=e.data)?void 0:a.data)||null}catch{}},W=async()=>{u.value=!0;try{await c.updateRetention(N),o.success("保存成功")}finally{u.value=!1}},X=async()=>{var a;try{await i.confirm("确定立即清理超过保留期限的日志？此操作不可恢复。","确认清理",{type:"warning"}),K.value=!0;const e=null==(a=(await c.cleanNow()).data)?void 0:a.data;o.success((null==e?void 0:e.message)||"清理完成"),J()}catch{}finally{K.value=!1}};return r(()=>{(async()=>{var a;try{const e=null==(a=(await c.getRetention()).data)?void 0:a.data;e&&Object.assign(N,e)}catch{}})(),J()}),(a,e)=>{const l=h("el-icon"),s=h("el-button"),t=h("el-alert"),o=h("el-input-number"),i=h("el-divider"),c=h("el-switch"),d=h("el-form-item"),r=h("el-time-picker"),k=h("el-form"),f=h("el-card");return L(),y("div",A,[M.value?(L(),y("div",I,[(L(!0),y(p,null,g(B.value,a=>(L(),y("div",{class:"stat-card",key:a.key},[w("span",U,_(a.count),1),w("span",j,_(a.label),1),a.oldest?(L(),y("span",H,"最早: "+_(a.oldest),1)):m("",!0)]))),128))])):m("",!0),v(f,null,{header:b(()=>[w("div",P,[e[4]||(e[4]=w("span",{class:"card-title"},"日志保留策略",-1)),w("div",R,[v(s,{type:"danger",onClick:X,loading:K.value},{default:b(()=>[v(l,null,{default:b(()=>[v(x(n))]),_:1}),e[2]||(e[2]=D(" 立即清理 ",-1))]),_:1},8,["loading"]),v(s,{type:"primary",onClick:W,loading:u.value},{default:b(()=>[...e[3]||(e[3]=[D(" 保存设置 ",-1)])]),_:1},8,["loading"])])])]),default:b(()=>[v(t,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:b(()=>[...e[5]||(e[5]=[D(" 设置各类日志的保留天数。超过保留期限的日志将被自动清理。设为 0 表示永不清理。 ",-1)])]),_:1}),w("div",S,[(L(),y(p,null,g(Q,a=>w("div",{class:"retention-item",key:a.key},[w("div",T,[v(l,{class:E(a.iconClass)},{default:b(()=>[(L(),V(O(a.icon)))]),_:2},1032,["class"]),w("span",G,_(a.label),1)]),w("div",q,[v(o,{modelValue:N[a.key],"onUpdate:modelValue":e=>N[a.key]=e,min:0,max:3650,step:30,class:"retention-input"},null,8,["modelValue","onUpdate:modelValue"]),e[6]||(e[6]=w("span",{class:"retention-unit"},"天",-1))]),w("div",z,_(a.hint),1)])),64))]),v(i),w("div",F,[e[8]||(e[8]=w("div",{class:"section-title"},"自动清理",-1)),v(k,{"label-width":"120px",style:{"max-width":"500px"}},{default:b(()=>[v(d,{label:"启用自动清理"},{default:b(()=>[v(c,{modelValue:N.autoCleanEnabled,"onUpdate:modelValue":e[0]||(e[0]=a=>N.autoCleanEnabled=a)},null,8,["modelValue"])]),_:1}),N.autoCleanEnabled?(L(),V(d,{key:0,label:"清理时间"},{default:b(()=>[v(r,{modelValue:N.autoCleanTime,"onUpdate:modelValue":e[1]||(e[1]=a=>N.autoCleanTime=a),format:"HH:mm","value-format":"HH:mm",placeholder:"每天执行清理的时间",style:{width:"140px"}},null,8,["modelValue"]),e[7]||(e[7]=w("span",{class:"field-hint"},"建议选择业务低峰时段",-1))]),_:1})):m("",!0)]),_:1})])]),_:1})])}}}),[["__scopeId","data-v-169435b0"]]);export{K as default};
