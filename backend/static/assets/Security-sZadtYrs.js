import{u as e,q as l,O as a,d as t,l as s,P as o,E as d}from"./elementPlus-DW6qdM9Z.js";import{i}from"./echarts-C-8LDSbe.js";import{k as u,f as c,_ as r}from"./index-D9Oaf6TO.js";import{v as n,k as p,D as m,E as v,F as f,r as _,n as y,ac as b,l as w,y as h,P as g,G as V,u as k,U as A,I as x,S as P,M as I,a6 as C,z as U,R as S,c as z,ad as T}from"./vendor-DDTA3iPl.js";const R={class:"security-page"},D={class:"dashboard-content"},E={class:"overview-cards"},K={class:"overview-card"},L={class:"card-icon users"},q={class:"card-info"},j={class:"card-value"},O={class:"overview-card"},B={class:"card-icon sessions"},W={class:"card-info"},$={class:"card-value"},H={class:"overview-card warning"},M={class:"card-icon"},N={class:"card-info"},F={class:"card-value"},G={class:"overview-card"},Y={class:"card-icon events"},J={class:"card-info"},Q={class:"card-value"},X={class:"overview-card danger"},Z={class:"card-icon"},ee={class:"card-info"},le={class:"card-value"},ae={class:"card-icon score"},te={class:"card-info"},se={class:"card-value"},oe={class:"threat-list"},de={class:"threat-ip"},ie={class:"threat-count"},ue={class:"filter-bar"},ce={class:"filter-bar"},re={class:"filter-bar"},ne={class:"session-stats"},pe={class:"stat-item"},me={class:"stat-value"},ve={class:"stat-item"},fe={class:"stat-value"},_e={class:"stat-item"},ye={class:"stat-value"},be={class:"stat-item-action"},we={key:0,class:"text-tertiary"},he={key:1},ge={class:"crypto-section"},Ve={class:"crypto-header"},ke={class:"crypto-cards"},Ae={class:"crypto-card-icon"},xe={class:"crypto-card-icon"},Pe={class:"crypto-card-icon"},Ie={key:0,class:"crypto-custom-form"},Ce={class:"crypto-action"},Ue=r(n({__name:"Security",setup(r){const n=_("dashboard"),Ue=_("blacklist"),Se=_("password"),ze=_(!1),Te=w({overview:{},recentEvents:[],loginTrend:[],threatSources:[]}),Re=_();let De=null;const Ee=_(!1),Ke=w({list:[],total:0}),Le=w({page:1,pageSize:20,eventType:"",severity:"",sourceIp:"",username:""}),qe=_(!1),je=_(!1),Oe=_(!1),Be=w({list:[],total:0}),We=w({list:[],total:0}),$e=w({list:[],total:0}),He=_(""),Me=_(!1),Ne=_(!1),Fe=w({ipAddress:"",reason:"",expiresIn:0}),Ge=w({ipAddress:"",description:""}),Ye=_(!1),Je=w({list:[],total:0}),Qe=z(()=>{var e;return(null==(e=Je.list)?void 0:e.filter(e=>"LDAP"!==e.userAgent).length)||0}),Xe=z(()=>{var e;return(null==(e=Je.list)?void 0:e.filter(e=>"LDAP"===e.userAgent).length)||0}),Ze=e=>{if(!e)return"-";const l=e.match(/(Chrome|Firefox|Safari|Edge|Cursor|Opera)[\/\s]([\d.]+)/);return l?`${l[1]} ${l[2].split(".")[0]}`:e.includes("curl")?"curl":e.length>40?e.substring(0,40)+"...":e},el=w({}),ll=w({account_lockout:{},ip_lockout:{}}),al=w({}),tl=_([]),sl=_([]),ol=()=>{var e,l,a;if(!Re.value)return;De||(De=i(Re.value));const t={tooltip:{trigger:"axis"},legend:{data:["成功","失败"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:(null==(e=Te.loginTrend)?void 0:e.map(e=>e.hour))||[]},yAxis:{type:"value"},series:[{name:"成功",type:"line",smooth:!0,data:(null==(l=Te.loginTrend)?void 0:l.map(e=>e.success))||[],itemStyle:{color:"#67c23a"}},{name:"失败",type:"line",smooth:!0,data:(null==(a=Te.loginTrend)?void 0:a.map(e=>e.failed))||[],itemStyle:{color:"#f56c6c"}}]};De.setOption(t)},dl=async()=>{Ee.value=!0;try{const e=await u.events(Le);e.data.success&&(Ke.list=e.data.data.list,Ke.total=e.data.data.total)}finally{Ee.value=!1}},il=async()=>{qe.value=!0;try{const e=await u.blacklist({page:1,pageSize:100});e.data.success&&(Be.list=e.data.data.list)}finally{qe.value=!1}},ul=async()=>{je.value=!0;try{const e=await u.whitelist({page:1,pageSize:100});e.data.success&&(We.list=e.data.data.list)}finally{je.value=!1}},cl=async()=>{Oe.value=!0;try{const e=await u.lockouts({page:1,pageSize:100});e.data.success&&($e.list=e.data.data.list)}finally{Oe.value=!1}},rl=async()=>{Fe.ipAddress&&Fe.reason?(await u.addBlacklist({ipAddress:Fe.ipAddress,reason:Fe.reason,expiresIn:Fe.expiresIn||void 0}),d.success("添加成功"),Me.value=!1,Fe.ipAddress="",Fe.reason="",il()):d.warning("请填写完整信息")},nl=async()=>{Ge.ipAddress?(await u.addWhitelist(Ge),d.success("添加成功"),Ne.value=!1,Ge.ipAddress="",Ge.description="",ul()):d.warning("请填写IP地址")},pl=async()=>{if(!He.value)return;const e=await u.checkIP(He.value);if(e.data.success){const l=e.data.data;let a=`IP: ${l.ip}\n`;a+=`黑名单: ${l.inBlacklist?"是 ("+l.blacklistReason+")":"否"}\n`,a+=`白名单: ${l.inWhitelist?"是":"否"}\n`,a+="锁定: "+(l.isLocked?"是":"否"),d.info({message:a,duration:5e3})}},ml=async()=>{Ye.value=!0;try{const e=await u.sessions({page:1,pageSize:100});e.data.success&&(Je.list=e.data.data.list)}finally{Ye.value=!1}},vl=async()=>{var e;if(null==(e=Je.list)?void 0:e.length){for(const e of Je.list)try{await u.terminateSession(e.id)}catch{}d.success("已终止所有会话"),ml()}},fl=async()=>{await u.updateConfig("password_policy",el),d.success("保存成功")},_l=async()=>{await u.updateConfig("login_security",ll),d.success("保存成功")},yl=async()=>{await u.updateConfig("session",al),d.success("保存成功")},bl=e=>e?new Date(e).toLocaleString():"-",wl=e=>{var l;return e/Math.max(...(null==(l=Te.threatSources)?void 0:l.map(e=>e.count))||[1])*100},hl=e=>({login_success:"登录成功",login_failed:"登录失败",login_blocked:"登录阻止",account_locked:"账户锁定",account_unlocked:"账户解锁",password_changed:"密码修改",ip_blocked:"IP封禁",ip_unblocked:"IP解封",config_changed:"配置变更",session_terminated:"会话终止"}[e]||e),gl=e=>e.includes("success")||e.includes("unlocked")||e.includes("unblocked")?"success":e.includes("failed")||e.includes("locked")||e.includes("blocked")?"danger":"info",Vl=e=>({low:"低",medium:"中",high:"高",critical:"严重"}[e]||e),kl=e=>({low:"info",medium:"warning",high:"danger",critical:"danger"}[e]||"info"),Al=w({source:"auto",privateKey:""}),xl=w({source:"auto",privateKey:""}),Pl=_(!1),Il=z(()=>({auto:"自动生成",https:"HTTPS 证书",custom:"自定义密钥"}[Al.source]||Al.source)),Cl=async()=>{var e,l;Pl.value=!0;try{await c.put("/settings/crypto",{source:xl.source,privateKey:"custom"===xl.source?xl.privateKey:""}),d.success("RSA 密钥配置已更新"),Al.source=xl.source,xl.privateKey=""}catch(a){d.error((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"保存失败")}finally{Pl.value=!1}};return p(()=>{(async()=>{ze.value=!0;try{const e=await u.dashboard();e.data.success&&(Object.assign(Te,e.data.data),await y(),ol())}finally{ze.value=!1}})(),dl(),il(),ul(),cl(),ml(),(async()=>{const e=await u.configs();if(e.data.success){const l=e.data.data;Object.assign(el,l.password_policy||{}),Object.assign(ll,l.login_security||{account_lockout:{},ip_lockout:{}}),Object.assign(al,l.session||{})}})(),(async()=>{const e=await u.notifyChannels();e.data.success&&(tl.value=e.data.data)})(),(async()=>{const e=await u.alertRules();e.data.success&&(sl.value=e.data.data)})(),(async()=>{var e;try{const l=await c.get("/settings/crypto"),a=(null==(e=l.data)?void 0:e.data)||l.data;Al.source=a.source||"auto",xl.source=Al.source,xl.privateKey=""}catch{}})()}),(i,c)=>{const r=b("el-icon"),p=b("el-card"),_=b("el-col"),y=b("el-progress"),w=b("el-empty"),z=b("el-row"),De=b("el-table-column"),tl=b("el-tag"),sl=b("el-table"),ol=b("el-tab-pane"),Ul=b("el-option"),Sl=b("el-select"),zl=b("el-input"),Tl=b("el-button"),Rl=b("el-pagination"),Dl=b("el-popconfirm"),El=b("el-tabs"),Kl=b("el-input-number"),Ll=b("el-form-item"),ql=b("el-switch"),jl=b("el-form"),Ol=b("el-divider"),Bl=b("Setting"),Wl=b("Key"),$l=b("el-dialog"),Hl=T("loading");return h(),m("div",R,[v(El,{modelValue:n.value,"onUpdate:modelValue":c[35]||(c[35]=e=>n.value=e),type:"border-card"},{default:f(()=>[v(ol,{label:"安全仪表板",name:"dashboard"},{default:f(()=>{var d,i,u,n,b,T,R;return[g((h(),m("div",D,[V("div",E,[V("div",K,[V("div",L,[v(r,null,{default:f(()=>[v(k(e))]),_:1})]),V("div",q,[V("div",j,A((null==(d=Te.overview)?void 0:d.totalUsers)||0),1),c[45]||(c[45]=V("div",{class:"card-label"},"用户总数",-1))])]),V("div",O,[V("div",B,[v(r,null,{default:f(()=>[v(k(l))]),_:1})]),V("div",W,[V("div",$,A((null==(i=Te.overview)?void 0:i.activeSessions)||0),1),c[46]||(c[46]=V("div",{class:"card-label"},"活跃会话",-1))])]),V("div",H,[V("div",M,[v(r,null,{default:f(()=>[v(k(a))]),_:1})]),V("div",N,[V("div",F,A((null==(u=Te.overview)?void 0:u.blockedIPs)||0),1),c[47]||(c[47]=V("div",{class:"card-label"},"封禁IP",-1))])]),V("div",G,[V("div",Y,[v(r,null,{default:f(()=>[v(k(t))]),_:1})]),V("div",J,[V("div",Q,A((null==(n=Te.overview)?void 0:n.eventsToday)||0),1),c[48]||(c[48]=V("div",{class:"card-label"},"今日事件",-1))])]),V("div",X,[V("div",Z,[v(r,null,{default:f(()=>[v(k(s))]),_:1})]),V("div",ee,[V("div",le,A((null==(b=Te.overview)?void 0:b.failedLogins24h)||0),1),c[49]||(c[49]=V("div",{class:"card-label"},"24h失败登录",-1))])]),V("div",{class:x(["overview-card",{success:((null==(T=Te.overview)?void 0:T.securityScore)||0)>=80}])},[V("div",ae,[v(r,null,{default:f(()=>[v(k(o))]),_:1})]),V("div",te,[V("div",se,A((null==(R=Te.overview)?void 0:R.securityScore)||0),1),c[50]||(c[50]=V("div",{class:"card-label"},"安全评分",-1))])],2)]),v(z,{gutter:20,class:"chart-row"},{default:f(()=>[v(_,{span:14},{default:f(()=>[v(p,null,{header:f(()=>[...c[51]||(c[51]=[P("登录趋势 (24小时)",-1)])]),default:f(()=>[V("div",{ref_key:"loginTrendChart",ref:Re,class:"chart-container"},null,512)]),_:1})]),_:1}),v(_,{span:10},{default:f(()=>[v(p,null,{header:f(()=>[...c[52]||(c[52]=[P("威胁来源 TOP10",-1)])]),default:f(()=>{var e;return[V("div",oe,[(h(!0),m(I,null,C(Te.threatSources,(e,l)=>(h(),m("div",{key:l,class:"threat-item"},[V("span",de,A(e.ip_address),1),v(y,{percentage:wl(e.count),"stroke-width":8,"show-text":!1},null,8,["percentage"]),V("span",ie,A(e.count)+"次",1)]))),128)),(null==(e=Te.threatSources)?void 0:e.length)?S("",!0):(h(),U(w,{key:0,description:"暂无威胁数据"}))])]}),_:1})]),_:1})]),_:1}),v(p,{class:"recent-events-card"},{header:f(()=>[...c[53]||(c[53]=[P("最近安全事件",-1)])]),default:f(()=>[v(sl,{data:Te.recentEvents,size:"small","max-height":"300"},{default:f(()=>[v(De,{prop:"createdAt",label:"时间",width:"160"},{default:f(({row:e})=>[P(A(bl(e.createdAt)),1)]),_:1}),v(De,{prop:"eventType",label:"类型",width:"120"},{default:f(({row:e})=>[v(tl,{type:gl(e.eventType),size:"small"},{default:f(()=>[P(A(hl(e.eventType)),1)]),_:2},1032,["type"])]),_:1}),v(De,{prop:"severity",label:"级别",width:"80"},{default:f(({row:e})=>[v(tl,{type:kl(e.severity),size:"small"},{default:f(()=>[P(A(Vl(e.severity)),1)]),_:2},1032,["type"])]),_:1}),v(De,{prop:"sourceIp",label:"来源IP",width:"120"}),v(De,{prop:"username",label:"用户",width:"100"}),v(De,{prop:"description",label:"描述","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1})])),[[Hl,ze.value]])]}),_:1}),v(ol,{label:"安全事件",name:"events"},{default:f(()=>[V("div",ue,[v(Sl,{modelValue:Le.eventType,"onUpdate:modelValue":c[0]||(c[0]=e=>Le.eventType=e),placeholder:"事件类型",clearable:"",class:"filter-select-md"},{default:f(()=>[v(Ul,{label:"登录成功",value:"login_success"}),v(Ul,{label:"登录失败",value:"login_failed"}),v(Ul,{label:"账户锁定",value:"account_locked"}),v(Ul,{label:"IP封禁",value:"ip_blocked"}),v(Ul,{label:"密码修改",value:"password_changed"}),v(Ul,{label:"配置变更",value:"config_changed"})]),_:1},8,["modelValue"]),v(Sl,{modelValue:Le.severity,"onUpdate:modelValue":c[1]||(c[1]=e=>Le.severity=e),placeholder:"严重级别",clearable:"",class:"filter-select-sm"},{default:f(()=>[v(Ul,{label:"低",value:"low"}),v(Ul,{label:"中",value:"medium"}),v(Ul,{label:"高",value:"high"}),v(Ul,{label:"严重",value:"critical"})]),_:1},8,["modelValue"]),v(zl,{modelValue:Le.sourceIp,"onUpdate:modelValue":c[2]||(c[2]=e=>Le.sourceIp=e),placeholder:"来源IP",clearable:"",class:"filter-select-md"},null,8,["modelValue"]),v(zl,{modelValue:Le.username,"onUpdate:modelValue":c[3]||(c[3]=e=>Le.username=e),placeholder:"用户名",clearable:"",class:"filter-select-sm"},null,8,["modelValue"]),v(Tl,{type:"primary",onClick:dl},{default:f(()=>[...c[54]||(c[54]=[P("搜索",-1)])]),_:1})]),g((h(),U(sl,{data:Ke.list},{default:f(()=>[v(De,{prop:"createdAt",label:"时间",width:"160"},{default:f(({row:e})=>[P(A(bl(e.createdAt)),1)]),_:1}),v(De,{prop:"eventType",label:"类型",width:"120"},{default:f(({row:e})=>[v(tl,{type:gl(e.eventType),size:"small"},{default:f(()=>[P(A(hl(e.eventType)),1)]),_:2},1032,["type"])]),_:1}),v(De,{prop:"severity",label:"级别",width:"80"},{default:f(({row:e})=>[v(tl,{type:kl(e.severity),size:"small"},{default:f(()=>[P(A(Vl(e.severity)),1)]),_:2},1032,["type"])]),_:1}),v(De,{prop:"sourceIp",label:"来源IP",width:"120"}),v(De,{prop:"username",label:"用户",width:"100"}),v(De,{prop:"description",label:"描述","show-overflow-tooltip":""}),v(De,{prop:"isResolved",label:"状态",width:"80"},{default:f(({row:e})=>[v(tl,{type:e.isResolved?"success":"warning",size:"small"},{default:f(()=>[P(A(e.isResolved?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),v(De,{label:"操作",width:"80"},{default:f(({row:e})=>[e.isResolved?S("",!0):(h(),U(Tl,{key:0,type:"primary",link:"",size:"small",onClick:l=>(async e=>{await u.resolveEvent(e),d.success("已处理"),dl()})(e.id)},{default:f(()=>[...c[55]||(c[55]=[P("处理",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[Hl,Ee.value]]),v(Rl,{"current-page":Le.page,"onUpdate:currentPage":c[4]||(c[4]=e=>Le.page=e),"page-size":Le.pageSize,"onUpdate:pageSize":c[5]||(c[5]=e=>Le.pageSize=e),total:Ke.total,layout:"total, prev, pager, next",onCurrentChange:dl},null,8,["current-page","page-size","total"])]),_:1}),v(ol,{label:"IP管理",name:"ip"},{default:f(()=>[v(El,{modelValue:Ue.value,"onUpdate:modelValue":c[9]||(c[9]=e=>Ue.value=e),type:"card"},{default:f(()=>[v(ol,{label:"黑名单",name:"blacklist"},{default:f(()=>[V("div",ce,[v(Tl,{type:"danger",onClick:c[6]||(c[6]=e=>Me.value=!0)},{default:f(()=>[...c[56]||(c[56]=[P("添加黑名单",-1)])]),_:1}),v(zl,{modelValue:He.value,"onUpdate:modelValue":c[7]||(c[7]=e=>He.value=e),placeholder:"输入IP检查状态",class:"ip-check-input"},null,8,["modelValue"]),v(Tl,{onClick:pl},{default:f(()=>[...c[57]||(c[57]=[P("检查",-1)])]),_:1})]),g((h(),U(sl,{data:Be.list},{default:f(()=>[v(De,{prop:"ipAddress",label:"IP地址",width:"150"}),v(De,{prop:"ipType",label:"类型",width:"80"}),v(De,{prop:"reason",label:"原因","show-overflow-tooltip":""}),v(De,{prop:"source",label:"来源",width:"80"},{default:f(({row:e})=>[v(tl,{size:"small"},{default:f(()=>[P(A("auto"===e.source?"自动":"手动"),1)]),_:2},1024)]),_:1}),v(De,{prop:"blockedCount",label:"阻止次数",width:"100"}),v(De,{prop:"expiresAt",label:"过期时间",width:"160"},{default:f(({row:e})=>[P(A(e.expiresAt?bl(e.expiresAt):"永久"),1)]),_:1}),v(De,{label:"操作",width:"80"},{default:f(({row:e})=>[v(Dl,{title:"确定移除?",onConfirm:l=>(async e=>{await u.removeBlacklist(e),d.success("移除成功"),il()})(e.id)},{reference:f(()=>[v(Tl,{type:"danger",link:"",size:"small"},{default:f(()=>[...c[58]||(c[58]=[P("移除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Hl,qe.value]])]),_:1}),v(ol,{label:"白名单",name:"whitelist"},{default:f(()=>[V("div",re,[v(Tl,{type:"primary",onClick:c[8]||(c[8]=e=>Ne.value=!0)},{default:f(()=>[...c[59]||(c[59]=[P("添加白名单",-1)])]),_:1})]),g((h(),U(sl,{data:We.list},{default:f(()=>[v(De,{prop:"ipAddress",label:"IP地址",width:"150"}),v(De,{prop:"ipType",label:"类型",width:"80"}),v(De,{prop:"description",label:"描述","show-overflow-tooltip":""}),v(De,{prop:"createdAt",label:"添加时间",width:"160"},{default:f(({row:e})=>[P(A(bl(e.createdAt)),1)]),_:1}),v(De,{label:"操作",width:"80"},{default:f(({row:e})=>[v(Dl,{title:"确定移除?",onConfirm:l=>(async e=>{await u.removeWhitelist(e),d.success("移除成功"),ul()})(e.id)},{reference:f(()=>[v(Tl,{type:"danger",link:"",size:"small"},{default:f(()=>[...c[60]||(c[60]=[P("移除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Hl,je.value]])]),_:1}),v(ol,{label:"锁定记录",name:"lockouts"},{default:f(()=>[g((h(),U(sl,{data:$e.list},{default:f(()=>[v(De,{prop:"lockType",label:"类型",width:"80"},{default:f(({row:e})=>[P(A("account"===e.lockType?"账户":"IP"),1)]),_:1}),v(De,{prop:"target",label:"目标",width:"150"}),v(De,{prop:"reason",label:"原因","show-overflow-tooltip":""}),v(De,{prop:"attemptCount",label:"尝试次数",width:"100"}),v(De,{prop:"expiresAt",label:"过期时间",width:"160"},{default:f(({row:e})=>[P(A(bl(e.expiresAt)),1)]),_:1}),v(De,{prop:"isActive",label:"状态",width:"80"},{default:f(({row:e})=>[v(tl,{type:e.isActive?"danger":"info",size:"small"},{default:f(()=>[P(A(e.isActive?"锁定中":"已解除"),1)]),_:2},1032,["type"])]),_:1}),v(De,{label:"操作",width:"80"},{default:f(({row:e})=>[e.isActive?(h(),U(Tl,{key:0,type:"primary",link:"",size:"small",onClick:l=>(async e=>{"account"===e.lockType?await u.unlockAccount(e.target):await u.unlockIP(e.target),d.success("解锁成功"),cl()})(e)},{default:f(()=>[...c[61]||(c[61]=[P("解锁",-1)])]),_:1},8,["onClick"])):S("",!0)]),_:1})]),_:1},8,["data"])),[[Hl,Oe.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(ol,{label:"会话管理",name:"sessions"},{default:f(()=>{var e;return[V("div",ne,[V("div",pe,[V("span",me,A((null==(e=Je.list)?void 0:e.length)||0),1),c[62]||(c[62]=V("span",{class:"stat-label"},"在线会话",-1))]),V("div",ve,[V("span",fe,A(Qe.value),1),c[63]||(c[63]=V("span",{class:"stat-label"},"Web 登录",-1))]),V("div",_e,[V("span",ye,A(Xe.value),1),c[64]||(c[64]=V("span",{class:"stat-label"},"LDAP 连接",-1))]),V("div",be,[v(Tl,{size:"small",onClick:ml},{default:f(()=>[...c[65]||(c[65]=[P("刷新",-1)])]),_:1}),v(Dl,{title:"确定终止所有会话？当前登录也将失效",onConfirm:vl},{reference:f(()=>{var e;return[v(Tl,{type:"danger",size:"small",disabled:!(null==(e=Je.list)?void 0:e.length)},{default:f(()=>[...c[66]||(c[66]=[P("全部终止",-1)])]),_:1},8,["disabled"])]}),_:1})])]),g((h(),U(sl,{data:Je.list,size:"small",stripe:""},{empty:f(()=>[v(w,{description:"暂无活跃会话","image-size":80})]),default:f(()=>[v(De,{label:"类型",width:"90",align:"center"},{default:f(({row:e})=>[v(tl,{type:"LDAP"===e.userAgent?"warning":"primary",size:"small",effect:"light"},{default:f(()=>[P(A("LDAP"===e.userAgent?"LDAP":"Web"),1)]),_:2},1032,["type"])]),_:1}),v(De,{prop:"username",label:"用户",width:"100"}),v(De,{prop:"ipAddress",label:"IP 地址",width:"130"},{default:f(({row:e})=>[P(A(e.ipAddress||"-"),1)]),_:1}),v(De,{label:"客户端","min-width":"180","show-overflow-tooltip":""},{default:f(({row:e})=>["LDAP"===e.userAgent?(h(),m("span",we,"LDAP Bind")):(h(),m("span",he,A(Ze(e.userAgent)),1))]),_:1}),v(De,{prop:"lastActivity",label:"最后活动",width:"160"},{default:f(({row:e})=>{return[V("span",{class:x((l=e.lastActivity,l&&Date.now()-new Date(l).getTime()<3e5?"text-success":""))},A(bl(e.lastActivity)),3)];var l}),_:1}),v(De,{prop:"createdAt",label:"创建时间",width:"160"},{default:f(({row:e})=>[P(A(bl(e.createdAt)),1)]),_:1}),v(De,{label:"操作",width:"80",align:"center"},{default:f(({row:e})=>[v(Dl,{title:"确定终止该会话？",onConfirm:l=>(async e=>{await u.terminateSession(e),d.success("已终止"),ml()})(e.id)},{reference:f(()=>[v(Tl,{type:"danger",link:"",size:"small"},{default:f(()=>[...c[67]||(c[67]=[P("终止",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Hl,Ye.value]])]}),_:1}),v(ol,{label:"安全策略",name:"policy"},{default:f(()=>[v(El,{modelValue:Se.value,"onUpdate:modelValue":c[30]||(c[30]=e=>Se.value=e),type:"card"},{default:f(()=>[v(ol,{label:"密码策略",name:"password"},{default:f(()=>[v(jl,{model:el,"label-width":"160px",class:"policy-form"},{default:f(()=>[v(Ll,{label:"最小长度"},{default:f(()=>[v(Kl,{modelValue:el.min_length,"onUpdate:modelValue":c[10]||(c[10]=e=>el.min_length=e),min:6,max:32},null,8,["modelValue"])]),_:1}),v(Ll,{label:"要求大写字母"},{default:f(()=>[v(ql,{modelValue:el.require_uppercase,"onUpdate:modelValue":c[11]||(c[11]=e=>el.require_uppercase=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"要求小写字母"},{default:f(()=>[v(ql,{modelValue:el.require_lowercase,"onUpdate:modelValue":c[12]||(c[12]=e=>el.require_lowercase=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"要求数字"},{default:f(()=>[v(ql,{modelValue:el.require_number,"onUpdate:modelValue":c[13]||(c[13]=e=>el.require_number=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"要求特殊字符"},{default:f(()=>[v(ql,{modelValue:el.require_special,"onUpdate:modelValue":c[14]||(c[14]=e=>el.require_special=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"密码历史记忆"},{default:f(()=>[v(Kl,{modelValue:el.history_count,"onUpdate:modelValue":c[15]||(c[15]=e=>el.history_count=e),min:0,max:20},null,8,["modelValue"]),c[68]||(c[68]=V("span",{class:"form-hint"},"次 (不能重复最近N次密码)",-1))]),_:1}),v(Ll,{label:"密码有效期"},{default:f(()=>[v(Kl,{modelValue:el.max_age_days,"onUpdate:modelValue":c[16]||(c[16]=e=>el.max_age_days=e),min:0,max:365},null,8,["modelValue"]),c[69]||(c[69]=V("span",{class:"form-hint"},"天 (0=不限制)",-1))]),_:1}),v(Ll,{label:"弱密码检查"},{default:f(()=>[v(ql,{modelValue:el.weak_password_check,"onUpdate:modelValue":c[17]||(c[17]=e=>el.weak_password_check=e)},null,8,["modelValue"])]),_:1}),v(Ll,null,{default:f(()=>[v(Tl,{type:"primary",onClick:fl},{default:f(()=>[...c[70]||(c[70]=[P("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),v(ol,{label:"登录安全",name:"login"},{default:f(()=>[v(jl,{model:ll,"label-width":"180px",class:"policy-form-lg"},{default:f(()=>[v(Ol,{"content-position":"left"},{default:f(()=>[...c[71]||(c[71]=[P("账户锁定",-1)])]),_:1}),v(Ll,{label:"启用账户锁定"},{default:f(()=>[v(ql,{modelValue:ll.account_lockout.enabled,"onUpdate:modelValue":c[18]||(c[18]=e=>ll.account_lockout.enabled=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"最大失败次数"},{default:f(()=>[v(Kl,{modelValue:ll.account_lockout.max_attempts,"onUpdate:modelValue":c[19]||(c[19]=e=>ll.account_lockout.max_attempts=e),min:3,max:20},null,8,["modelValue"])]),_:1}),v(Ll,{label:"首次锁定时长"},{default:f(()=>[v(Kl,{modelValue:ll.account_lockout.lockout_duration_minutes,"onUpdate:modelValue":c[20]||(c[20]=e=>ll.account_lockout.lockout_duration_minutes=e),min:5,max:1440},null,8,["modelValue"]),c[72]||(c[72]=V("span",{class:"form-hint"},"分钟",-1))]),_:1}),v(Ll,{label:"渐进式锁定"},{default:f(()=>[v(ql,{modelValue:ll.account_lockout.progressive_lockout,"onUpdate:modelValue":c[21]||(c[21]=e=>ll.account_lockout.progressive_lockout=e)},null,8,["modelValue"])]),_:1}),v(Ol,{"content-position":"left"},{default:f(()=>[...c[73]||(c[73]=[P("IP锁定",-1)])]),_:1}),v(Ll,{label:"启用IP锁定"},{default:f(()=>[v(ql,{modelValue:ll.ip_lockout.enabled,"onUpdate:modelValue":c[22]||(c[22]=e=>ll.ip_lockout.enabled=e)},null,8,["modelValue"])]),_:1}),v(Ll,{label:"IP最大失败次数"},{default:f(()=>[v(Kl,{modelValue:ll.ip_lockout.max_attempts,"onUpdate:modelValue":c[23]||(c[23]=e=>ll.ip_lockout.max_attempts=e),min:5,max:100},null,8,["modelValue"])]),_:1}),v(Ll,{label:"IP锁定时长"},{default:f(()=>[v(Kl,{modelValue:ll.ip_lockout.lockout_duration_hours,"onUpdate:modelValue":c[24]||(c[24]=e=>ll.ip_lockout.lockout_duration_hours=e),min:1,max:168},null,8,["modelValue"]),c[74]||(c[74]=V("span",{class:"form-hint"},"小时",-1))]),_:1}),v(Ll,null,{default:f(()=>[v(Tl,{type:"primary",onClick:_l},{default:f(()=>[...c[75]||(c[75]=[P("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),v(ol,{label:"会话配置",name:"session"},{default:f(()=>[v(jl,{model:al,"label-width":"180px",class:"policy-form"},{default:f(()=>[v(Ll,{label:"Token有效期"},{default:f(()=>[v(Kl,{modelValue:al.access_token_ttl_minutes,"onUpdate:modelValue":c[25]||(c[25]=e=>al.access_token_ttl_minutes=e),min:10,max:1440},null,8,["modelValue"]),c[76]||(c[76]=V("span",{class:"form-hint"},"分钟",-1))]),_:1}),v(Ll,{label:"最大并发会话数"},{default:f(()=>[v(Kl,{modelValue:al.max_concurrent_sessions,"onUpdate:modelValue":c[26]||(c[26]=e=>al.max_concurrent_sessions=e),min:1,max:20},null,8,["modelValue"])]),_:1}),v(Ll,{label:"单会话模式"},{default:f(()=>[v(ql,{modelValue:al.single_session_mode,"onUpdate:modelValue":c[27]||(c[27]=e=>al.single_session_mode=e)},null,8,["modelValue"]),c[77]||(c[77]=V("span",{class:"form-hint"},"新登录踢掉旧会话",-1))]),_:1}),v(Ll,{label:"IP绑定"},{default:f(()=>[v(ql,{modelValue:al.ip_binding,"onUpdate:modelValue":c[28]||(c[28]=e=>al.ip_binding=e)},null,8,["modelValue"]),c[78]||(c[78]=V("span",{class:"form-hint"},"IP变更会话失效",-1))]),_:1}),v(Ll,{label:"空闲超时"},{default:f(()=>[v(Kl,{modelValue:al.idle_timeout_minutes,"onUpdate:modelValue":c[29]||(c[29]=e=>al.idle_timeout_minutes=e),min:5,max:1440},null,8,["modelValue"]),c[79]||(c[79]=V("span",{class:"form-hint"},"分钟",-1))]),_:1}),v(Ll,null,{default:f(()=>[v(Tl,{type:"primary",onClick:yl},{default:f(()=>[...c[80]||(c[80]=[P("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(ol,{label:"传输加密",name:"crypto"},{default:f(()=>[V("div",ge,[V("div",Ve,[c[81]||(c[81]=V("h3",{class:"crypto-title"},"RSA 密钥配置",-1)),v(tl,{type:"auto"===Al.source?"success":"https"===Al.source?"primary":"warning",size:"small",effect:"light"},{default:f(()=>[P(" 当前："+A(Il.value),1)]),_:1},8,["type"])]),V("div",ke,[V("div",{class:x(["crypto-card",{active:"auto"===xl.source}]),onClick:c[31]||(c[31]=e=>xl.source="auto")},[V("div",Ae,[v(r,{size:"24"},{default:f(()=>[v(Bl)]),_:1})]),c[83]||(c[83]=V("div",{class:"crypto-card-content"},[V("div",{class:"crypto-card-title"},"自动生成"),V("div",{class:"crypto-card-desc"},"系统自动生成 RSA-2048 密钥对，持久化存储到服务器文件")],-1)),"auto"===xl.source?(h(),U(tl,{key:0,type:"primary",size:"small",effect:"light",class:"crypto-badge"},{default:f(()=>[...c[82]||(c[82]=[P("推荐",-1)])]),_:1})):S("",!0)],2),V("div",{class:x(["crypto-card",{active:"https"===xl.source}]),onClick:c[32]||(c[32]=e=>xl.source="https")},[V("div",xe,[v(r,{size:"24"},{default:f(()=>[v(k(s))]),_:1})]),c[84]||(c[84]=V("div",{class:"crypto-card-content"},[V("div",{class:"crypto-card-title"},"复用 HTTPS 证书"),V("div",{class:"crypto-card-desc"},"使用已配置的 HTTPS SSL 证书中的 RSA 密钥")],-1))],2),V("div",{class:x(["crypto-card",{active:"custom"===xl.source}]),onClick:c[33]||(c[33]=e=>xl.source="custom")},[V("div",Pe,[v(r,{size:"24"},{default:f(()=>[v(Wl)]),_:1})]),c[86]||(c[86]=V("div",{class:"crypto-card-content"},[V("div",{class:"crypto-card-title"},"自定义密钥对"),V("div",{class:"crypto-card-desc"},"上传自己的 RSA 私钥（PEM 格式，PKCS#1 或 PKCS#8）")],-1)),"custom"===xl.source?(h(),U(tl,{key:0,type:"warning",size:"small",effect:"light",class:"crypto-badge"},{default:f(()=>[...c[85]||(c[85]=[P("高级",-1)])]),_:1})):S("",!0)],2)]),"custom"===xl.source?(h(),m("div",Ie,[v(Ll,{label:"RSA 私钥","label-width":"100px"},{default:f(()=>[v(zl,{modelValue:xl.privateKey,"onUpdate:modelValue":c[34]||(c[34]=e=>xl.privateKey=e),type:"textarea",rows:6,placeholder:"-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----",class:"mono-textarea"},null,8,["modelValue"]),c[87]||(c[87]=V("div",{class:"field-hint"},"密钥长度建议 2048 位以上",-1))]),_:1})])):S("",!0),V("div",Ce,[v(Tl,{type:"primary",onClick:Cl,loading:Pl.value},{default:f(()=>[...c[88]||(c[88]=[P("保存配置",-1)])]),_:1},8,["loading"])])])]),_:1})]),_:1},8,["modelValue"]),v($l,{modelValue:Me.value,"onUpdate:modelValue":c[40]||(c[40]=e=>Me.value=e),title:"添加IP黑名单",width:"450px"},{footer:f(()=>[v(Tl,{onClick:c[39]||(c[39]=e=>Me.value=!1)},{default:f(()=>[...c[89]||(c[89]=[P("取消",-1)])]),_:1}),v(Tl,{type:"primary",onClick:rl},{default:f(()=>[...c[90]||(c[90]=[P("确定",-1)])]),_:1})]),default:f(()=>[v(jl,{model:Fe,"label-width":"100px"},{default:f(()=>[v(Ll,{label:"IP地址",required:""},{default:f(()=>[v(zl,{modelValue:Fe.ipAddress,"onUpdate:modelValue":c[36]||(c[36]=e=>Fe.ipAddress=e),placeholder:"支持单IP或CIDR格式"},null,8,["modelValue"])]),_:1}),v(Ll,{label:"原因",required:""},{default:f(()=>[v(zl,{modelValue:Fe.reason,"onUpdate:modelValue":c[37]||(c[37]=e=>Fe.reason=e),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1}),v(Ll,{label:"过期时间"},{default:f(()=>[v(Sl,{modelValue:Fe.expiresIn,"onUpdate:modelValue":c[38]||(c[38]=e=>Fe.expiresIn=e),class:"full-width"},{default:f(()=>[v(Ul,{label:"永久",value:0}),v(Ul,{label:"1小时",value:1}),v(Ul,{label:"24小时",value:24}),v(Ul,{label:"7天",value:168}),v(Ul,{label:"30天",value:720})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),v($l,{modelValue:Ne.value,"onUpdate:modelValue":c[44]||(c[44]=e=>Ne.value=e),title:"添加IP白名单",width:"450px"},{footer:f(()=>[v(Tl,{onClick:c[43]||(c[43]=e=>Ne.value=!1)},{default:f(()=>[...c[91]||(c[91]=[P("取消",-1)])]),_:1}),v(Tl,{type:"primary",onClick:nl},{default:f(()=>[...c[92]||(c[92]=[P("确定",-1)])]),_:1})]),default:f(()=>[v(jl,{model:Ge,"label-width":"100px"},{default:f(()=>[v(Ll,{label:"IP地址",required:""},{default:f(()=>[v(zl,{modelValue:Ge.ipAddress,"onUpdate:modelValue":c[41]||(c[41]=e=>Ge.ipAddress=e),placeholder:"支持单IP或CIDR格式"},null,8,["modelValue"])]),_:1}),v(Ll,{label:"描述"},{default:f(()=>[v(zl,{modelValue:Ge.description,"onUpdate:modelValue":c[42]||(c[42]=e=>Ge.description=e),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-9c7e4c69"]]);export{Ue as default};
