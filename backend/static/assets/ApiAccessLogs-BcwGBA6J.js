import{v as e,k as a,D as l,G as t,U as s,E as d,F as o,r,ac as n,l as u,y as p,am as i,S as c,P as v,z as h,R as g,I as y,ad as m}from"./vendor-DDTA3iPl.js";import{o as w,_ as b}from"./index-D9Oaf6TO.js";import"./elementPlus-DW6qdM9Z.js";const f={class:"api-logs-page"},x={class:"stat-row"},T={class:"stat-card"},_={class:"stat-value"},V={class:"stat-card stat-success"},C={class:"stat-value"},z={class:"stat-card"},E={class:"stat-value"},P={class:"stat-card stat-error"},U={class:"stat-value"},k={class:"filter-bar"},D={class:"log-expand"},G={key:0,class:"expand-section"},R={key:1,class:"expand-section"},S={class:"code-block"},A={key:2,class:"expand-section"},I={class:"text-error"},L={class:"expand-section"},q={class:"text-muted"},B={class:"pagination-bar"},K=b(e({__name:"ApiAccessLogs",setup(e){const b=r([]),K=r(!1),j=r(1),M=r(20),Y=r(0),O=r({}),F=u({authType:"",method:"",path:"",ip:"",statusGroup:"",dateRange:null}),J=async()=>{var e,a;K.value=!0;try{const l={page:j.value,size:M.value};F.authType&&(l.authType=F.authType),F.method&&(l.method=F.method),F.path&&(l.path=F.path),F.ip&&(l.ip=F.ip),F.statusGroup&&(l.statusGroup=F.statusGroup),2===(null==(e=F.dateRange)?void 0:e.length)&&(l.startDate=F.dateRange[0],l.endDate=F.dateRange[1]);const t=null==(a=(await w.apiLogs(l)).data)?void 0:a.data;b.value=(null==t?void 0:t.list)||[],Y.value=(null==t?void 0:t.total)||0}finally{K.value=!1}};return a(()=>{J(),(async()=>{var e;try{const a=await w.apiLogStats();O.value=(null==(e=a.data)?void 0:e.data)||{}}catch{}})()}),(e,a)=>{const r=n("el-option"),u=n("el-select"),w=n("el-input"),W=n("el-date-picker"),N=n("el-button"),Q=n("el-table-column"),H=n("el-tag"),X=n("el-table"),Z=n("el-pagination"),$=n("el-card"),ee=m("loading");return p(),l("div",f,[t("div",x,[t("div",T,[t("span",_,s(O.value.totalToday||0),1),a[8]||(a[8]=t("span",{class:"stat-label"},"今日调用",-1))]),t("div",V,[t("span",C,s(O.value.successRate||"0")+"%",1),a[9]||(a[9]=t("span",{class:"stat-label"},"成功率",-1))]),t("div",z,[t("span",E,s(O.value.avgDuration||0)+"ms",1),a[10]||(a[10]=t("span",{class:"stat-label"},"平均耗时",-1))]),t("div",P,[t("span",U,s(O.value.errorCount||0),1),a[11]||(a[11]=t("span",{class:"stat-label"},"今日异常",-1))])]),d($,null,{header:o(()=>[...a[12]||(a[12]=[t("div",{class:"card-header-row"},[t("span",{class:"card-title"},"API 调用日志"),t("div",{class:"header-actions"})],-1)])]),default:o(()=>[t("div",k,[d(u,{modelValue:F.authType,"onUpdate:modelValue":a[0]||(a[0]=e=>F.authType=e),placeholder:"认证类型",clearable:"",style:{width:"130px"},onChange:J},{default:o(()=>[d(r,{label:"API Key",value:"apikey"}),d(r,{label:"JWT",value:"jwt"})]),_:1},8,["modelValue"]),d(u,{modelValue:F.method,"onUpdate:modelValue":a[1]||(a[1]=e=>F.method=e),placeholder:"请求方法",clearable:"",style:{width:"110px"},onChange:J},{default:o(()=>[d(r,{label:"GET",value:"GET"}),d(r,{label:"POST",value:"POST"}),d(r,{label:"PUT",value:"PUT"}),d(r,{label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue"]),d(w,{modelValue:F.path,"onUpdate:modelValue":a[2]||(a[2]=e=>F.path=e),placeholder:"请求路径",clearable:"",style:{width:"200px"},onClear:J,onKeyup:i(J,["enter"])},null,8,["modelValue"]),d(w,{modelValue:F.ip,"onUpdate:modelValue":a[3]||(a[3]=e=>F.ip=e),placeholder:"来源IP",clearable:"",style:{width:"150px"},onClear:J,onKeyup:i(J,["enter"])},null,8,["modelValue"]),d(u,{modelValue:F.statusGroup,"onUpdate:modelValue":a[4]||(a[4]=e=>F.statusGroup=e),placeholder:"状态",clearable:"",style:{width:"110px"},onChange:J},{default:o(()=>[d(r,{label:"成功(2xx)",value:"2xx"}),d(r,{label:"客户端错误(4xx)",value:"4xx"}),d(r,{label:"服务端错误(5xx)",value:"5xx"})]),_:1},8,["modelValue"]),d(W,{modelValue:F.dateRange,"onUpdate:modelValue":a[5]||(a[5]=e=>F.dateRange=e),type:"daterange","range-separator":"-","start-placeholder":"开始","end-placeholder":"结束","value-format":"YYYY-MM-DD",style:{width:"240px"},onChange:J},null,8,["modelValue"]),d(N,{type:"primary",onClick:J},{default:o(()=>[...a[13]||(a[13]=[c("搜索",-1)])]),_:1})]),v((p(),h(X,{data:b.value,stripe:"",size:"small","row-key":"id"},{default:o(()=>[d(Q,{type:"expand"},{default:o(({row:e})=>[t("div",D,[e.query?(p(),l("div",G,[a[14]||(a[14]=t("strong",null,"Query: ",-1)),t("code",null,s(e.query),1)])):g("",!0),e.requestBody?(p(),l("div",R,[a[15]||(a[15]=t("strong",null,"Request Body: ",-1)),t("pre",S,s(e.requestBody),1)])):g("",!0),e.errorMessage?(p(),l("div",A,[a[16]||(a[16]=t("strong",null,"Error: ",-1)),t("span",I,s(e.errorMessage),1)])):g("",!0),t("div",L,[a[17]||(a[17]=t("strong",null,"User-Agent: ",-1)),t("span",q,s(e.userAgent||"-"),1)])])]),_:1}),d(Q,{label:"时间",width:"155"},{default:o(({row:e})=>{return[c(s((a=e.createdAt,a?new Date(a).toLocaleString("zh-CN"):"-")),1)];var a}),_:1}),d(Q,{label:"认证",width:"90",align:"center"},{default:o(({row:e})=>[d(H,{type:"apikey"===e.authType?"warning":"primary",size:"small",effect:"light"},{default:o(()=>[c(s("apikey"===e.authType?"APIKey":"JWT"),1)]),_:2},1032,["type"])]),_:1}),d(Q,{label:"调用者",width:"120"},{default:o(({row:e})=>[c(s(e.appId||e.username||"-"),1)]),_:1}),d(Q,{label:"方法",width:"70",align:"center"},{default:o(({row:e})=>{return[d(H,{type:(a=e.method,{GET:"",POST:"success",PUT:"warning",DELETE:"danger"}[a]||"info"),size:"small",effect:"plain"},{default:o(()=>[c(s(e.method),1)]),_:2},1032,["type"])];var a}),_:1}),d(Q,{prop:"path",label:"路径","min-width":"200","show-overflow-tooltip":""}),d(Q,{label:"状态",width:"70",align:"center"},{default:o(({row:e})=>[d(H,{type:e.statusCode<400?"success":e.statusCode<500?"warning":"danger",size:"small",effect:"light"},{default:o(()=>[c(s(e.statusCode),1)]),_:2},1032,["type"])]),_:1}),d(Q,{label:"耗时",width:"80",align:"center"},{default:o(({row:e})=>[t("span",{class:y({"text-error":e.duration>1e3})},s(e.duration)+"ms",3)]),_:1}),d(Q,{prop:"ip",label:"来源IP",width:"130"}),d(Q,{label:"响应大小",width:"90",align:"center"},{default:o(({row:e})=>{return[c(s((a=e.responseSize,a?a<1024?a+"B":(a/1024).toFixed(1)+"KB":"-")),1)];var a}),_:1})]),_:1},8,["data"])),[[ee,K.value]]),t("div",B,[d(Z,{"current-page":j.value,"onUpdate:currentPage":a[6]||(a[6]=e=>j.value=e),"page-size":M.value,"onUpdate:pageSize":a[7]||(a[7]=e=>M.value=e),total:Y.value,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:J,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),_:1})])}}}),[["__scopeId","data-v-062445d7"]]);export{K as default};
