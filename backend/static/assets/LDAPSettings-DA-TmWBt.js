import{v as a,k as e,D as l,G as s,I as d,U as n,E as o,F as t,W as i,R as c,r,l as u,ac as m,y as p,M as b,S as g}from"./vendor-DDTA3iPl.js";import{m as y,_ as f}from"./index-D9Oaf6TO.js";import{E as v}from"./elementPlus-DW6qdM9Z.js";const D={class:"ldap-page"},V={class:"page-header"},w={class:"header-right"},h={class:"status-text"},N={class:"section-card"},P={class:"switch-row"},S={key:0,class:"sub-fields"},L={class:"field-row"},T={class:"field-row"},U={class:"field-row"},x={class:"field-row"},C={class:"field-row"},F={key:0,class:"section-card"},k={class:"form-grid"},z={class:"form-field"},_={class:"form-field"},M={key:1,class:"section-card"},A={class:"accounts-grid"},B={class:"account-card"},R={class:"account-body"},j={class:"form-field"},E={class:"form-field"},I={class:"account-card"},K={class:"account-body"},$={class:"form-field"},H={class:"form-field"},G={key:2,class:"actions-bar"},O={key:3,class:"actions-bar"},W=f(a({__name:"LDAPSettings",setup(a){const f=r(!1),W=r(!1),q=u({enabled:!1,port:389,useTLS:!1,tlsPort:636,tlsCertFile:"",tlsKeyFile:"",domain:"",baseDN:"",managerDN:"",managerPassword:"",readonlyDN:"",readonlyPassword:"",sambaEnabled:!0,sambaSID:""}),J=u({running:!1,enabled:!1}),Q=()=>{if(q.domain){const a=q.domain.split(".");q.baseDN=a.map(a=>"dc="+a).join(","),q.managerDN="cn=Manager,"+q.baseDN,q.readonlyDN="cn=readonly,"+q.baseDN}},X=async()=>{try{const a=await y.status();a.data.success&&a.data.data&&(J.running=a.data.data.running,J.enabled=a.data.data.enabled)}catch(a){}},Y=async()=>{if(!q.enabled||q.baseDN)if(!q.enabled||q.managerDN){f.value=!0;try{(await y.updateConfig(q)).data.success&&(v.success("配置已保存"),await X())}catch(a){}finally{f.value=!1}}else v.warning("请设置 Manager Bind DN");else v.warning("请设置域名和 Base DN")},Z=async()=>{var a,e;W.value=!0;try{const l=await y.test();if(l.data.success){const s=l.data.data,d=null==(a=s.results)?void 0:a.manager,n=null==(e=s.results)?void 0:e.readonly;"连接成功"!==d||"连接成功"!==n&&"未配置密码"!==n?v.warning(`Manager: ${d} · Readonly: ${n}`):v.success(`测试通过 · Manager: ${d} · Readonly: ${n} · 条目: ${s.entries}`)}}catch(l){}finally{W.value=!1}};return e(()=>{(async()=>{try{const a=await y.getConfig();if(a.data.success&&a.data.data){const e=a.data.data;Object.assign(q,{enabled:e.enabled||!1,port:e.port||389,useTLS:e.useTLS||!1,tlsPort:e.tlsPort||636,tlsCertFile:e.tlsCertFile||"",tlsKeyFile:e.tlsKeyFile||"",domain:e.domain||"",baseDN:e.baseDN||"",managerDN:e.managerDN||"",managerPassword:"",readonlyDN:e.readonlyDN||"",readonlyPassword:"",sambaEnabled:!1!==e.sambaEnabled,sambaSID:e.sambaSID||""})}}catch(a){}})(),X()}),(a,e)=>{const r=m("el-switch"),u=m("el-input-number"),y=m("el-input"),v=m("el-button");return p(),l("div",D,[s("div",V,[e[12]||(e[12]=s("div",{class:"header-left"},[s("h2",null,"LDAP 服务"),s("p",{class:"header-desc"},"为第三方系统提供用户和角色信息的 LDAP 目录服务")],-1)),s("div",w,[s("span",{class:d(["status-dot",J.running?"active":""])},null,2),s("span",h,n(J.running?"运行中":"已停止"),1)])]),s("div",N,[s("div",P,[e[13]||(e[13]=s("div",{class:"switch-info"},[s("span",{class:"switch-label"},"启用 LDAP 服务"),s("span",{class:"switch-desc"},"开启后，第三方系统可通过 LDAP 协议接入")],-1)),o(r,{modelValue:q.enabled,"onUpdate:modelValue":e[0]||(e[0]=a=>q.enabled=a)},null,8,["modelValue"])]),o(i,{name:"fade"},{default:t(()=>[q.enabled?(p(),l("div",S,[s("div",L,[e[14]||(e[14]=s("label",null,"端口",-1)),o(u,{modelValue:q.port,"onUpdate:modelValue":e[1]||(e[1]=a=>q.port=a),min:1,max:65535,"controls-position":"right",size:"default"},null,8,["modelValue"])]),s("div",T,[e[15]||(e[15]=s("div",{class:"switch-info",style:{flex:"1"}},[s("span",{class:"switch-label",style:{"font-size":"13px"}},"启用 LDAPS（TLS 加密）")],-1)),o(r,{modelValue:q.useTLS,"onUpdate:modelValue":e[2]||(e[2]=a=>q.useTLS=a),size:"small"},null,8,["modelValue"])]),q.useTLS?(p(),l(b,{key:0},[s("div",U,[e[16]||(e[16]=s("label",null,"LDAPS 端口",-1)),o(u,{modelValue:q.tlsPort,"onUpdate:modelValue":e[3]||(e[3]=a=>q.tlsPort=a),min:1,max:65535,"controls-position":"right",size:"default"},null,8,["modelValue"])]),s("div",x,[e[17]||(e[17]=s("label",null,"TLS 证书",-1)),o(y,{modelValue:q.tlsCertFile,"onUpdate:modelValue":e[4]||(e[4]=a=>q.tlsCertFile=a),placeholder:"留空复用 HTTPS 证书",size:"default"},null,8,["modelValue"])]),s("div",C,[e[18]||(e[18]=s("label",null,"TLS 私钥",-1)),o(y,{modelValue:q.tlsKeyFile,"onUpdate:modelValue":e[5]||(e[5]=a=>q.tlsKeyFile=a),placeholder:"留空复用 HTTPS 私钥",size:"default"},null,8,["modelValue"])])],64)):c("",!0)])):c("",!0)]),_:1})]),q.enabled?(p(),l("div",F,[e[22]||(e[22]=s("div",{class:"section-title"},"域设置",-1)),s("div",k,[s("div",z,[e[19]||(e[19]=s("label",null,"域名",-1)),o(y,{modelValue:q.domain,"onUpdate:modelValue":e[6]||(e[6]=a=>q.domain=a),placeholder:"example.com",onChange:Q},null,8,["modelValue"]),e[20]||(e[20]=s("span",{class:"field-hint"},"输入域名后自动生成 Base DN",-1))]),s("div",_,[e[21]||(e[21]=s("label",null,"Base DN",-1)),o(y,{modelValue:q.baseDN,"onUpdate:modelValue":e[7]||(e[7]=a=>q.baseDN=a),placeholder:"dc=example,dc=com"},null,8,["modelValue"])])])])):c("",!0),q.enabled?(p(),l("div",M,[e[29]||(e[29]=s("div",{class:"section-title"},"服务账号",-1)),e[30]||(e[30]=s("p",{class:"section-desc"},"Manager 拥有完整权限，Readonly 仅可查询。建议第三方系统使用 Readonly 账号。",-1)),s("div",A,[s("div",B,[e[25]||(e[25]=s("div",{class:"account-header"},[s("div",{class:"account-badge manager"},"Manager"),s("span",{class:"account-role"},"管理员 · 完整权限")],-1)),s("div",R,[s("div",j,[e[23]||(e[23]=s("label",null,"Bind DN",-1)),o(y,{modelValue:q.managerDN,"onUpdate:modelValue":e[8]||(e[8]=a=>q.managerDN=a),placeholder:"cn=Manager,dc=example,dc=com"},null,8,["modelValue"])]),s("div",E,[e[24]||(e[24]=s("label",null,"密码",-1)),o(y,{modelValue:q.managerPassword,"onUpdate:modelValue":e[9]||(e[9]=a=>q.managerPassword=a),type:"password","show-password":"",placeholder:"设置密码"},null,8,["modelValue"])])])]),s("div",I,[e[28]||(e[28]=s("div",{class:"account-header"},[s("div",{class:"account-badge readonly"},"Readonly"),s("span",{class:"account-role"},"只读 · 仅查询权限")],-1)),s("div",K,[s("div",$,[e[26]||(e[26]=s("label",null,"Bind DN",-1)),o(y,{modelValue:q.readonlyDN,"onUpdate:modelValue":e[10]||(e[10]=a=>q.readonlyDN=a),placeholder:"cn=readonly,dc=example,dc=com"},null,8,["modelValue"])]),s("div",H,[e[27]||(e[27]=s("label",null,"密码",-1)),o(y,{modelValue:q.readonlyPassword,"onUpdate:modelValue":e[11]||(e[11]=a=>q.readonlyPassword=a),type:"password","show-password":"",placeholder:"设置密码"},null,8,["modelValue"])])])])])])):c("",!0),q.enabled?(p(),l("div",G,[o(v,{type:"primary",onClick:Y,loading:f.value,size:"large"},{default:t(()=>[...e[31]||(e[31]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),o(v,{onClick:Z,loading:W.value,disabled:!J.running,size:"large",plain:""},{default:t(()=>[...e[32]||(e[32]=[g(" 测试连接 ",-1)])]),_:1},8,["loading","disabled"])])):(p(),l("div",O,[o(v,{type:"primary",onClick:Y,loading:f.value,size:"large"},{default:t(()=>[...e[33]||(e[33]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"])]))])}}}),[["__scopeId","data-v-a6f0ffb8"]]);export{W as default};
