import{J as e,r as l,G as a,E as u,K as t}from"./elementPlus-DW6qdM9Z.js";import{b as d,_ as s}from"./index-D9Oaf6TO.js";import{v as n,k as o,D as r,E as i,F as p,r as m,ac as c,y as v,G as b,u as y,S as f,P as _,z as h,U as w,I as g,R as V,M as k,a6 as T,ad as U}from"./vendor-DDTA3iPl.js";const D={class:"downstream-page"},C={class:"tab-toolbar"},A={class:"row-name"},x={class:"conn-addr"},S={class:"tab-toolbar"},z={class:"row-name"},P={class:"trigger-tags"},N={key:2,class:"text-muted"},q={class:"tab-toolbar"},I={class:"row-name"},L={key:1,class:"text-muted"},R={class:"mapping-footer"},j={class:"addr-row"},E={key:0,class:"field-hint"},O={key:1,class:"field-hint"},B={class:"schedule-times-list"},M=s(n({__name:"DownstreamSync",setup(s){const n={mysql:"MySQL",postgresql:"PostgreSQL",oracle:"Oracle",sqlserver:"SQL Server"},M={mysql:3306,postgresql:5432,oracle:1521,sqlserver:1433},Q=e=>{if(!e)return"-";try{const l=JSON.parse(e);if(Array.isArray(l))return l.join(", ")}catch{}return e},G=e=>"ldap_ad"===e.type?"LDAP AD":"ldap_generic"===e.type?"LDAP 通用":n[e.dbType||e.type]||e.type,H=m("connectors"),J=m([]),$=m(!1),F=m(0),K=m(!1),W=m(!1),X=m(0),Y=m(!1),Z={name:"",type:"ldap_ad",direction:"downstream",host:"",port:636,useTls:!0,baseDn:"",bindDn:"",bindPassword:"",upnSuffix:"",database:"",dbUser:"",dbPassword:"",dbType:"mysql",userTable:"",groupTable:"",roleTable:"",timeout:5},ee=m({...Z}),le=async()=>{var e;$.value=!0;try{const l=await d.downstreamConnectors();J.value=(null==(e=l.data)?void 0:e.data)||[]}finally{$.value=!1}},ae=e=>{if(ee.value={...Z},e){W.value=!0,X.value=e.id;const l="mysql"===e.type?"database":e.type;Object.assign(ee.value,{name:e.name,type:l,direction:"downstream",host:e.host,port:e.port,useTls:e.useTls,baseDn:e.baseDn,bindDn:e.bindDn,bindPassword:"",upnSuffix:e.upnSuffix,database:e.database,dbUser:e.dbUser,dbPassword:"",dbType:e.dbType||"mysql",userTable:e.userTable,groupTable:e.groupTable||"",roleTable:e.roleTable||"",timeout:e.timeout})}else W.value=!1,X.value=0;K.value=!0},ue=e=>{ee.value.port="ldap_ad"===e||"ldap_generic"===e?ee.value.useTls?636:389:M[ee.value.dbType]||3306},te=e=>{ee.value.port=M[e]||3306},de=async()=>{if(ee.value.name&&ee.value.host){Y.value=!0;try{W.value?await d.updateDownstreamConnector(X.value,ee.value):await d.createDownstreamConnector(ee.value),u.success("保存成功"),K.value=!1,le()}finally{Y.value=!1}}else u.warning("请填写必填项")},se=m([]),ne=m(!1),oe=m(0),re=m(!1),ie=m(!1),pe=m(0),me=m(!1),ce=["user_create","user_update","user_delete","user_enable","user_disable","password_change","group_change","role_change"],ve={name:"",connectorId:0,direction:"downstream",targetContainer:"",enableEvent:!0,enableSchedule:!1,events:[...ce],syncUsers:!0,syncGroups:!0,syncRoles:!0,scheduleType:"times",scheduleTimes:[],scheduleInterval:60,statusBool:!0},be=m({...ve}),ye=e=>{if(!e)return[];try{const l=JSON.parse(e);if(Array.isArray(l))return l}catch{}return e.includes(",")?e.split(",").map(e=>e.trim()).filter(Boolean):e?[e]:[]},fe=async()=>{var e;ne.value=!0;try{const l=await d.downstreamRules();se.value=(null==(e=l.data)?void 0:e.data)||[]}finally{ne.value=!1}},_e=e=>{if(be.value={...ve},e){ie.value=!0,pe.value=e.id;let l=[...ce];if(e.events)try{const a="string"==typeof e.events?JSON.parse(e.events):e.events;Array.isArray(a)&&a.length>0&&(l=a)}catch{}be.value={name:e.name,connectorId:e.connectorId,direction:"downstream",targetContainer:e.targetContainer||"",enableEvent:e.enableEvent??!0,enableSchedule:e.enableSchedule??!1,events:l,syncUsers:e.syncUsers??!0,syncGroups:e.syncGroups??!0,syncRoles:e.syncRoles??!0,scheduleType:e.scheduleType||"times",scheduleTimes:ye(e.scheduleTime),scheduleInterval:e.scheduleInterval||60,statusBool:1===e.status}}else ie.value=!1,pe.value=0,J.value.length>0&&(be.value.connectorId=J.value[0].id);re.value=!0},he=async()=>{if(be.value.name&&be.value.connectorId){me.value=!0;try{const e={...be.value,status:be.value.statusBool?1:0};ie.value?await d.updateDownstreamRule(pe.value,e):await d.createDownstreamRule(e),u.success("保存成功"),re.value=!1,fe()}finally{me.value=!1}}else u.warning("请填写必填项")},we=[{value:"name",label:"姓名 (name)"},{value:"username",label:"用户名 (username)"},{value:"nickname",label:"昵称 (nickname)"},{value:"email",label:"邮箱 (email)"},{value:"phone",label:"手机号 (phone)"},{value:"avatar",label:"头像 (avatar)"},{value:"position",label:"职位 (position)"},{value:"department",label:"部门 (department)"},{value:"group_name",label:"群组名称 (group_name)"},{value:"description",label:"描述 (description)"},{value:"status",label:"状态 (status)"},{value:"password_raw",label:"明文密码 (password_raw)"},{value:"code",label:"工号 (code)"},{value:"job_title",label:"岗位 (job_title)"}],ge=[{value:"sAMAccountName",label:"登录名 (sAMAccountName)"},{value:"cn",label:"通用名 (cn)"},{value:"displayName",label:"显示名 (displayName)"},{value:"mail",label:"邮箱 (mail)"},{value:"mobile",label:"手机号 (mobile)"},{value:"telephoneNumber",label:"电话 (telephoneNumber)"},{value:"title",label:"职位 (title)"},{value:"department",label:"部门 (department)"},{value:"description",label:"描述 (description)"},{value:"givenName",label:"名 (givenName)"},{value:"sn",label:"姓 (sn)"},{value:"ou",label:"组织单元 (ou)"},{value:"userPrincipalName",label:"UPN (userPrincipalName)"},{value:"unicodePwd",label:"Unicode密码 (unicodePwd)"},{value:"userAccountControl",label:"账户控制 (userAccountControl)"}],Ve=[{value:"uid",label:"用户ID (uid)"},{value:"cn",label:"通用名 (cn)"},{value:"displayName",label:"显示名 (displayName)"},{value:"sn",label:"姓 (sn)"},{value:"givenName",label:"名 (givenName)"},{value:"mail",label:"邮箱 (mail)"},{value:"telephoneNumber",label:"电话 (telephoneNumber)"},{value:"title",label:"职位 (title)"},{value:"ou",label:"组织单元 (ou)"},{value:"userPassword",label:"密码 (userPassword)"},{value:"description",label:"描述 (description)"},{value:"employeeNumber",label:"工号 (employeeNumber)"},{value:"postalAddress",label:"地址 (postalAddress)"}],ke=[{value:"username",label:"用户名 (username)"},{value:"password",label:"密码 (password)"},{value:"display_name",label:"显示名 (display_name)"},{value:"email",label:"邮箱 (email)"},{value:"phone",label:"手机号 (phone)"},{value:"department",label:"部门 (department)"},{value:"position",label:"职位 (position)"},{value:"status",label:"状态 (status)"},{value:"created_at",label:"创建时间 (created_at)"}],Te=[{value:"name",label:"群组名称 (name)"},{value:"description",label:"描述 (description)"},{value:"parent_name",label:"上级群组名称 (parent_name)"}],Ue=[{value:"name",label:"角色名称 (name)"},{value:"code",label:"角色编码 (code)"},{value:"description",label:"描述 (description)"}],De=[{value:"ou",label:"组织单元 (ou)"},{value:"description",label:"描述 (description)"},{value:"name",label:"名称 (name)"}],Ce=[{value:"ou",label:"组织单元 (ou)"},{value:"description",label:"描述 (description)"}],Ae=[{value:"name",label:"名称 (name)"},{value:"description",label:"描述 (description)"},{value:"parent_id",label:"上级ID (parent_id)"}],xe=[{value:"name",label:"名称 (name)"},{value:"code",label:"编码 (code)"},{value:"description",label:"描述 (description)"}],Se=e=>{const l=qe.value;return"group"===e?"ldap_ad"===l?De:"ldap_generic"===l?Ce:Ae:"role"===e?xe:"ldap_ad"===l?ge:"ldap_generic"===l?Ve:ke},ze=[{value:"chinese_surname",label:"提取中文姓氏"},{value:"chinese_given_name",label:"提取中文名字"},{value:"password_to_unicode",label:"密码转Unicode（AD）"},{value:"status_to_uac",label:"状态转账户控制 - 禁用时AD禁用"},{value:"status_to_delete",label:"状态转账户控制 - 禁用时AD删除"},{value:"append:@domain.com",label:"追加域名后缀"},{value:"pinyin",label:"中文转拼音"},{value:"email_prefix",label:"邮箱前缀"},{value:"to_upper",label:"转大写"},{value:"to_lower",label:"转小写"}],Pe=m(0),Ne=m(""),qe=m("ldap_ad"),Ie=m([]),Le=m(!1),Re=()=>{Pe.value=0,H.value="rules"},je=()=>{Ie.value.push({sourceAttribute:"",targetAttribute:"",mappingType:"mapping",transformRule:"",objectType:"user",isEnabled:!0,priority:(Ie.value.length||0)+1})},Ee=async()=>{Le.value=!0;try{let e=0;for(const l of Ie.value)l.priority=e++;await d.updateDownstreamRuleMappings(Pe.value,Ie.value),u.success("映射已保存")}finally{Le.value=!1}};return o(()=>{le(),fe()}),(s,n)=>{const o=c("el-icon"),m=c("el-button"),M=c("el-table-column"),X=c("el-tag"),Z=c("el-empty"),pe=c("el-table"),ce=c("el-tab-pane"),ve=c("el-option"),ye=c("el-select"),ge=c("el-switch"),Ve=c("el-tabs"),ke=c("el-input"),De=c("el-form-item"),Ce=c("el-radio-button"),Ae=c("el-radio-group"),xe=c("el-divider"),Oe=c("el-input-number"),Be=c("el-form"),Me=c("el-dialog"),Qe=c("el-radio"),Ge=c("el-time-picker"),He=U("loading");return v(),r("div",D,[i(Ve,{modelValue:H.value,"onUpdate:modelValue":n[2]||(n[2]=e=>H.value=e),type:"border-card"},{default:p(()=>[i(ce,{label:"下游连接器",name:"connectors"},{default:p(()=>[b("div",C,[n[34]||(n[34]=b("span",{class:"tab-desc"},"配置LDAP/AD或数据库作为下游同步目标",-1)),i(m,{type:"primary",onClick:n[0]||(n[0]=e=>ae())},{default:p(()=>[i(o,null,{default:p(()=>[i(y(e))]),_:1}),n[33]||(n[33]=f(" 新增连接器 ",-1))]),_:1})]),_((v(),h(pe,{data:J.value,stripe:"",size:"small"},{empty:p(()=>[i(Z,{description:"暂无下游连接器","image-size":100})]),default:p(()=>[i(M,{prop:"name",label:"名称","min-width":"160"},{default:p(({row:e})=>[b("span",A,w(e.name),1)]),_:1}),i(M,{label:"类型",width:"140",align:"center"},{default:p(({row:e})=>[i(X,{type:"ldap_ad"===e.type?"primary":"ldap_generic"===e.type?"warning":"success",size:"small",effect:"light"},{default:p(()=>[f(w(G(e)),1)]),_:2},1032,["type"])]),_:1}),i(M,{label:"地址","min-width":"180"},{default:p(({row:e})=>[b("span",x,w(e.host)+":"+w(e.port),1)]),_:1}),i(M,{label:"健康",width:"90",align:"center"},{default:p(({row:e})=>[b("span",{class:g(["health-dot",{online:e.lastTestOk,offline:e.lastTestAt&&!e.lastTestOk}])},null,2),f(" "+w(e.lastTestOk?"正常":e.lastTestAt?"异常":"未测试"),1)]),_:1}),i(M,{label:"操作",width:"200",fixed:"right"},{default:p(({row:e})=>[i(m,{type:"primary",link:"",size:"small",onClick:l=>(async e=>{var l,a,t;F.value=e.id;try{const a=null==(l=(await d.testDownstreamConnector(e.id)).data)?void 0:l.data;(null==a?void 0:a.ok)?u.success((null==a?void 0:a.message)||"连接成功"):u.error((null==a?void 0:a.message)||"连接失败"),le()}catch(s){u.error((null==(t=null==(a=null==s?void 0:s.response)?void 0:a.data)?void 0:t.message)||"连接失败"),le()}finally{F.value=0}})(e),loading:F.value===e.id},{default:p(()=>[...n[35]||(n[35]=[f("测试",-1)])]),_:1},8,["onClick","loading"]),i(m,{type:"primary",link:"",size:"small",onClick:l=>ae(e)},{default:p(()=>[...n[36]||(n[36]=[f("编辑",-1)])]),_:1},8,["onClick"]),i(m,{type:"danger",link:"",size:"small",onClick:l=>(async e=>{try{await t.confirm(`确定删除连接器「${e.name}」？`,"确认删除",{type:"warning"}),await d.deleteDownstreamConnector(e.id),u.success("删除成功"),le()}catch{}})(e)},{default:p(()=>[...n[37]||(n[37]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[He,$.value]])]),_:1}),i(ce,{label:"同步规则",name:"rules"},{default:p(()=>[b("div",S,[n[39]||(n[39]=b("span",{class:"tab-desc"},"定义将本地用户数据同步到下游系统的规则和属性映射",-1)),i(m,{type:"primary",onClick:n[1]||(n[1]=e=>_e())},{default:p(()=>[i(o,null,{default:p(()=>[i(y(e))]),_:1}),n[38]||(n[38]=f(" 新增规则 ",-1))]),_:1})]),_((v(),h(pe,{data:se.value,stripe:"",size:"small"},{empty:p(()=>[i(Z,{description:"暂无同步规则","image-size":100})]),default:p(()=>[i(M,{prop:"name",label:"规则名称","min-width":"150"},{default:p(({row:e})=>[b("span",z,w(e.name),1)]),_:1}),i(M,{label:"连接器",width:"150"},{default:p(({row:e})=>{var l;return[i(X,{size:"small",effect:"light",type:"ldap_ad"===(null==(l=e.connector)?void 0:l.type)?"primary":"success"},{default:p(()=>{var l;return[f(w((null==(l=e.connector)?void 0:l.name)||"-"),1)]}),_:2},1032,["type"])]}),_:1}),i(M,{label:"触发方式","min-width":"160"},{default:p(({row:e})=>[b("div",P,[e.enableEvent?(v(),h(X,{key:0,type:"warning",size:"small",effect:"light"},{default:p(()=>[...n[40]||(n[40]=[f("事件",-1)])]),_:1})):V("",!0),e.enableSchedule?(v(),h(X,{key:1,type:"primary",size:"small",effect:"light"},{default:p(()=>[f(" 定时 "+w("interval"===e.scheduleType?(e.scheduleInterval||60)+"分钟":Q(e.scheduleTime)),1)]),_:2},1024)):V("",!0),e.enableEvent||e.enableSchedule?V("",!0):(v(),r("span",N,"手动"))])]),_:1}),i(M,{label:"状态",width:"80",align:"center"},{default:p(({row:e})=>[i(X,{type:1===e.status?"success":"danger",size:"small",effect:"light"},{default:p(()=>[f(w(1===e.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),i(M,{label:"操作",width:"250",fixed:"right"},{default:p(({row:e})=>[i(m,{type:"success",link:"",size:"small",onClick:l=>(async e=>{oe.value=e.id;try{await d.triggerDownstreamRule(e.id),u.success("下游同步已触发"),setTimeout(fe,3e3)}finally{oe.value=0}})(e),loading:oe.value===e.id},{default:p(()=>[i(o,null,{default:p(()=>[i(y(l))]),_:1}),n[41]||(n[41]=f(" 同步 ",-1))]),_:1},8,["onClick","loading"]),i(m,{type:"primary",link:"",size:"small",onClick:l=>(async e=>{var l;Pe.value=e.id,Ne.value=e.name;const a=J.value.find(l=>l.id===e.connectorId);qe.value=(null==a?void 0:a.type)||"ldap_ad",H.value="mappings";try{const a=await d.downstreamRuleMappings(e.id);Ie.value=(null==(l=a.data)?void 0:l.data)||[]}catch{Ie.value=[]}})(e)},{default:p(()=>[...n[42]||(n[42]=[f("映射",-1)])]),_:1},8,["onClick"]),i(m,{type:"primary",link:"",size:"small",onClick:l=>_e(e)},{default:p(()=>[...n[43]||(n[43]=[f("编辑",-1)])]),_:1},8,["onClick"]),i(m,{type:"danger",link:"",size:"small",onClick:l=>(async e=>{try{await t.confirm(`确定删除规则「${e.name}」？`,"确认删除",{type:"warning"}),await d.deleteDownstreamRule(e.id),u.success("删除成功"),fe()}catch{}})(e)},{default:p(()=>[...n[44]||(n[44]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[He,ne.value]])]),_:1}),Pe.value?(v(),h(ce,{key:0,label:"属性映射",name:"mappings",disabled:!Pe.value},{default:p(()=>[b("div",q,[b("div",null,[b("span",I,w(Ne.value),1),i(m,{link:"",type:"info",onClick:Re,style:{"margin-left":"12px"}},{default:p(()=>[...n[45]||(n[45]=[f("← 返回规则列表",-1)])]),_:1})]),i(m,{type:"primary",size:"small",onClick:je},{default:p(()=>[i(o,null,{default:p(()=>[i(y(e))]),_:1}),n[46]||(n[46]=f(" 新增映射 ",-1))]),_:1})]),i(pe,{data:Ie.value,size:"small"},{default:p(()=>[i(M,{label:"对象",width:"100",align:"center"},{default:p(({row:e})=>[i(ye,{modelValue:e.objectType,"onUpdate:modelValue":l=>e.objectType=l,size:"small"},{default:p(()=>[i(ve,{label:"用户",value:"user"}),i(ve,{label:"群组",value:"group"}),i(ve,{label:"角色",value:"role"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),i(M,{label:"本地属性","min-width":"180"},{default:p(({row:e})=>[i(ye,{modelValue:e.sourceAttribute,"onUpdate:modelValue":l=>e.sourceAttribute=l,size:"small",class:"full-width",filterable:"","allow-create":"",placeholder:"选择或输入"},{default:p(()=>{return[(v(!0),r(k,null,T((l=e.objectType,"group"===l?Te:"role"===l?Ue:we),e=>(v(),h(ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))];var l}),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),i(M,{label:"",width:"50",align:"center"},{default:p(()=>[...n[47]||(n[47]=[b("span",{class:"mapping-arrow"},"→",-1)])]),_:1}),i(M,{label:"目标属性","min-width":"180"},{default:p(({row:e})=>[i(ye,{modelValue:e.targetAttribute,"onUpdate:modelValue":l=>e.targetAttribute=l,size:"small",class:"full-width",filterable:"","allow-create":"",placeholder:"选择或输入"},{default:p(()=>[(v(!0),r(k,null,T(Se(e.objectType),e=>(v(),h(ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),i(M,{label:"映射方式",width:"130"},{default:p(({row:e})=>[i(ye,{modelValue:e.mappingType,"onUpdate:modelValue":l=>e.mappingType=l,size:"small",class:"full-width"},{default:p(()=>[i(ve,{label:"直接映射",value:"mapping"}),i(ve,{label:"转换",value:"transform"}),i(ve,{label:"常量",value:"constant"}),i(ve,{label:"表达式",value:"expression"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),i(M,{label:"转换规则","min-width":"180"},{default:p(({row:e})=>["mapping"!==e.mappingType?(v(),h(ye,{key:0,modelValue:e.transformRule,"onUpdate:modelValue":l=>e.transformRule=l,size:"small",class:"full-width",filterable:"","allow-create":"",placeholder:"选择或输入规则"},{default:p(()=>[(v(),r(k,null,T(ze,e=>i(ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])):(v(),r("span",L,"-"))]),_:1}),i(M,{label:"启用",width:"60",align:"center"},{default:p(({row:e})=>[i(ge,{modelValue:e.isEnabled,"onUpdate:modelValue":l=>e.isEnabled=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(M,{label:"操作",width:"60",align:"center"},{default:p(({$index:e})=>[i(m,{type:"danger",link:"",size:"small",onClick:l=>Ie.value.splice(e,1)},{default:p(()=>[i(o,null,{default:p(()=>[i(y(a))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),b("div",R,[i(m,{type:"primary",onClick:Ee,loading:Le.value},{default:p(()=>[...n[48]||(n[48]=[f("保存映射",-1)])]),_:1},8,["loading"])])]),_:1},8,["disabled"])):V("",!0)]),_:1},8,["modelValue"]),i(Me,{modelValue:K.value,"onUpdate:modelValue":n[21]||(n[21]=e=>K.value=e),title:W.value?"编辑下游连接器":"新增下游连接器",width:"640px","destroy-on-close":""},{footer:p(()=>[i(m,{onClick:n[20]||(n[20]=e=>K.value=!1)},{default:p(()=>[...n[53]||(n[53]=[f("取消",-1)])]),_:1}),i(m,{type:"primary",onClick:de,loading:Y.value},{default:p(()=>[...n[54]||(n[54]=[f("保存",-1)])]),_:1},8,["loading"])]),default:p(()=>[i(Be,{model:ee.value,"label-width":"110px"},{default:p(()=>[i(De,{label:"连接器名称",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.name,"onUpdate:modelValue":n[3]||(n[3]=e=>ee.value.name=e),placeholder:"如：AD域服务器"},null,8,["modelValue"])]),_:1}),i(De,{label:"类型",required:""},{default:p(()=>[i(Ae,{modelValue:ee.value.type,"onUpdate:modelValue":n[4]||(n[4]=e=>ee.value.type=e),disabled:W.value,onChange:ue},{default:p(()=>[i(Ce,{value:"ldap_ad"},{default:p(()=>[...n[49]||(n[49]=[f("LDAP AD",-1)])]),_:1}),i(Ce,{value:"ldap_generic"},{default:p(()=>[...n[50]||(n[50]=[f("LDAP 通用",-1)])]),_:1}),i(Ce,{value:"database"},{default:p(()=>[...n[51]||(n[51]=[f("数据库",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),"database"===ee.value.type?(v(),h(De,{key:0,label:"数据库类型",required:""},{default:p(()=>[i(ye,{modelValue:ee.value.dbType,"onUpdate:modelValue":n[5]||(n[5]=e=>ee.value.dbType=e),class:"full-width",onChange:te,disabled:W.value},{default:p(()=>[i(ve,{label:"MySQL",value:"mysql"}),i(ve,{label:"PostgreSQL",value:"postgresql"}),i(ve,{label:"Oracle",value:"oracle"}),i(ve,{label:"SQL Server",value:"sqlserver"})]),_:1},8,["modelValue","disabled"])]),_:1})):V("",!0),i(xe,{"content-position":"left"},{default:p(()=>[...n[52]||(n[52]=[f("连接参数",-1)])]),_:1}),i(De,{label:"地址",required:""},{default:p(()=>[b("div",j,[i(ke,{modelValue:ee.value.host,"onUpdate:modelValue":n[6]||(n[6]=e=>ee.value.host=e),placeholder:"服务器地址",class:"addr-host"},null,8,["modelValue"]),i(Oe,{modelValue:ee.value.port,"onUpdate:modelValue":n[7]||(n[7]=e=>ee.value.port=e),min:1,max:65535,class:"addr-port"},null,8,["modelValue"])])]),_:1}),"ldap_ad"===ee.value.type||"ldap_generic"===ee.value.type?(v(),r(k,{key:1},[i(De,{label:"LDAPS"},{default:p(()=>[i(ge,{modelValue:ee.value.useTls,"onUpdate:modelValue":n[8]||(n[8]=e=>ee.value.useTls=e)},null,8,["modelValue"]),"ldap_ad"===ee.value.type?(v(),r("span",E,"AD密码同步必须启用LDAPS")):(v(),r("span",O,"启用TLS加密连接"))]),_:1}),i(De,{label:"Base DN",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.baseDn,"onUpdate:modelValue":n[9]||(n[9]=e=>ee.value.baseDn=e),placeholder:"dc=example,dc=com"},null,8,["modelValue"])]),_:1}),i(De,{label:"Bind DN",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.bindDn,"onUpdate:modelValue":n[10]||(n[10]=e=>ee.value.bindDn=e),placeholder:"ldap_ad"===ee.value.type?"cn=administrator,cn=users,dc=example,dc=com":"cn=admin,dc=example,dc=com"},null,8,["modelValue","placeholder"])]),_:1}),i(De,{label:"密码",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.bindPassword,"onUpdate:modelValue":n[11]||(n[11]=e=>ee.value.bindPassword=e),type:"password","show-password":"",placeholder:W.value?"留空不修改":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),"ldap_ad"===ee.value.type?(v(),h(De,{key:0,label:"UPN后缀"},{default:p(()=>[i(ke,{modelValue:ee.value.upnSuffix,"onUpdate:modelValue":n[12]||(n[12]=e=>ee.value.upnSuffix=e),placeholder:"@example.com"},null,8,["modelValue"])]),_:1})):V("",!0)],64)):V("",!0),"database"===ee.value.type?(v(),r(k,{key:2},[i(De,{label:"oracle"===ee.value.dbType?"服务名":"数据库名",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.database,"onUpdate:modelValue":n[13]||(n[13]=e=>ee.value.database=e),placeholder:"数据库名"},null,8,["modelValue"])]),_:1},8,["label"]),i(De,{label:"用户名",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.dbUser,"onUpdate:modelValue":n[14]||(n[14]=e=>ee.value.dbUser=e),placeholder:"数据库用户名"},null,8,["modelValue"])]),_:1}),i(De,{label:"密码",required:""},{default:p(()=>[i(ke,{modelValue:ee.value.dbPassword,"onUpdate:modelValue":n[15]||(n[15]=e=>ee.value.dbPassword=e),type:"password","show-password":"",placeholder:W.value?"留空不修改":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),i(De,{label:"用户表名"},{default:p(()=>[i(ke,{modelValue:ee.value.userTable,"onUpdate:modelValue":n[16]||(n[16]=e=>ee.value.userTable=e),placeholder:"如: users"},null,8,["modelValue"])]),_:1}),i(De,{label:"组织表名"},{default:p(()=>[i(ke,{modelValue:ee.value.groupTable,"onUpdate:modelValue":n[17]||(n[17]=e=>ee.value.groupTable=e),placeholder:"如: departments / groups"},null,8,["modelValue"])]),_:1}),i(De,{label:"角色表名"},{default:p(()=>[i(ke,{modelValue:ee.value.roleTable,"onUpdate:modelValue":n[18]||(n[18]=e=>ee.value.roleTable=e),placeholder:"如: roles"},null,8,["modelValue"])]),_:1})],64)):V("",!0),i(De,{label:"超时(秒)"},{default:p(()=>[i(Oe,{modelValue:ee.value.timeout,"onUpdate:modelValue":n[19]||(n[19]=e=>ee.value.timeout=e),min:1,max:60},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),i(Me,{modelValue:re.value,"onUpdate:modelValue":n[32]||(n[32]=e=>re.value=e),title:ie.value?"编辑同步规则":"新增同步规则",width:"560px","destroy-on-close":""},{footer:p(()=>[i(m,{onClick:n[31]||(n[31]=e=>re.value=!1)},{default:p(()=>[...n[58]||(n[58]=[f("取消",-1)])]),_:1}),i(m,{type:"primary",onClick:he,loading:me.value},{default:p(()=>[...n[59]||(n[59]=[f("保存",-1)])]),_:1},8,["loading"])]),default:p(()=>[i(Be,{model:be.value,"label-width":"110px"},{default:p(()=>[i(De,{label:"规则名称",required:""},{default:p(()=>[i(ke,{modelValue:be.value.name,"onUpdate:modelValue":n[22]||(n[22]=e=>be.value.name=e),placeholder:"如：用户同步到AD"},null,8,["modelValue"])]),_:1}),i(De,{label:"下游连接器",required:""},{default:p(()=>[i(ye,{modelValue:be.value.connectorId,"onUpdate:modelValue":n[23]||(n[23]=e=>be.value.connectorId=e),class:"full-width"},{default:p(()=>[(v(!0),r(k,null,T(J.value,e=>(v(),h(ve,{key:e.id,label:e.name+" ("+G(e)+")",value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),V("",!0),i(De,{label:"事件触发"},{default:p(()=>[i(ge,{modelValue:be.value.enableEvent,"onUpdate:modelValue":n[25]||(n[25]=e=>be.value.enableEvent=e)},null,8,["modelValue"]),n[55]||(n[55]=b("span",{class:"field-hint"},"用户变更时自动触发同步",-1))]),_:1}),i(De,{label:"定时同步"},{default:p(()=>[i(ge,{modelValue:be.value.enableSchedule,"onUpdate:modelValue":n[26]||(n[26]=e=>be.value.enableSchedule=e)},null,8,["modelValue"])]),_:1}),be.value.enableSchedule?(v(),r(k,{key:1},[i(De,{label:"调度模式"},{default:p(()=>[i(Ae,{modelValue:be.value.scheduleType,"onUpdate:modelValue":n[27]||(n[27]=e=>be.value.scheduleType=e)},{default:p(()=>[i(Qe,{value:"times"},{default:p(()=>[...n[56]||(n[56]=[f("定点时间",-1)])]),_:1}),i(Qe,{value:"interval"},{default:p(()=>[...n[57]||(n[57]=[f("固定间隔",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"times"===be.value.scheduleType?(v(),h(De,{key:0,label:"自动同步时间"},{default:p(()=>[b("div",B,[(v(!0),r(k,null,T(be.value.scheduleTimes,(e,l)=>(v(),r("div",{key:l,class:"schedule-time-row"},[i(Ge,{modelValue:be.value.scheduleTimes[l],"onUpdate:modelValue":e=>be.value.scheduleTimes[l]=e,format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",style:{width:"140px"}},null,8,["modelValue","onUpdate:modelValue"]),i(m,{type:"danger",size:"small",onClick:e=>be.value.scheduleTimes.splice(l,1)},{default:p(()=>[i(o,null,{default:p(()=>[i(y(a))]),_:1})]),_:1},8,["onClick"])]))),128)),i(m,{type:"primary",size:"small",onClick:n[28]||(n[28]=e=>be.value.scheduleTimes.push("08:00"))},{default:p(()=>[i(o,null,{default:p(()=>[i(y(e))]),_:1})]),_:1})])]),_:1})):V("",!0),"interval"===be.value.scheduleType?(v(),h(De,{key:1,label:"同步间隔(分钟)"},{default:p(()=>[i(Oe,{modelValue:be.value.scheduleInterval,"onUpdate:modelValue":n[29]||(n[29]=e=>be.value.scheduleInterval=e),min:5,max:1440,step:5},null,8,["modelValue"])]),_:1})):V("",!0)],64)):V("",!0),i(De,{label:"状态"},{default:p(()=>[i(ge,{modelValue:be.value.statusBool,"onUpdate:modelValue":n[30]||(n[30]=e=>be.value.statusBool=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-f6edd88e"]]);export{M as default};
