import{s as l,r as e,_ as a}from"./index-D9Oaf6TO.js";import{E as s}from"./elementPlus-DW6qdM9Z.js";import{v as d,k as t,D as c,G as i,I as o,U as n,E as u,M as r,F as p,R as m,r as v,l as f,ac as h,y as b,a6 as g,z as V,S as y}from"./vendor-DDTA3iPl.js";const w={class:"dingtalk-page"},I={class:"page-header"},U={class:"header-right"},k={class:"status-text"},R={class:"section-card"},_={class:"switch-row"},S={class:"section-card"},A={class:"form-grid"},D={class:"form-field"},K={class:"form-field"},j={class:"form-field"},x={class:"form-field"},F={class:"section-card"},C={class:"form-grid"},z={class:"form-field"},E={class:"form-field"},G={class:"inline-switch"},M={key:0,class:"form-grid",style:{"margin-top":"16px"}},O={class:"form-field"},P={class:"actions-bar"},q=a(d({__name:"DataSourceDingtalk",setup(a){const d=v(!1),q=v([]),B=f({enabled:!1,appKey:"",appSecret:"",agentId:"",corpId:"",matchField:"mobile",autoRegister:!1,defaultRoleId:0}),H=async()=>{d.value=!0;try{await l.updateDingtalk(B),s.success("保存成功")}finally{d.value=!1}};return t(()=>{(async()=>{try{const e=await l.getDingtalk();e.data.success&&e.data.data&&(Object.assign(B,e.data.data),B.appSecret="")}catch(e){}})(),(async()=>{try{const l=await e.list();l.data.success&&(q.value=l.data.data||[])}catch(l){}})()}),(l,e)=>{const a=h("el-switch"),s=h("el-input"),t=h("el-option"),v=h("el-select"),f=h("el-button");return b(),c("div",w,[i("div",I,[e[8]||(e[8]=i("div",{class:"header-left"},[i("h2",null,"钉钉对接"),i("p",{class:"header-desc"},"对接钉钉组织架构，同步用户信息并支持钉钉免登")],-1)),i("div",U,[i("span",{class:o(["status-dot",B.enabled?"active":""])},null,2),i("span",k,n(B.enabled?"已启用":"未启用"),1)])]),i("div",R,[i("div",_,[e[9]||(e[9]=i("div",{class:"switch-info"},[i("span",{class:"switch-label"},"启用钉钉对接"),i("span",{class:"switch-desc"},"开启后，系统将同步钉钉组织架构和用户信息，并支持钉钉工作台免登")],-1)),u(a,{modelValue:B.enabled,"onUpdate:modelValue":e[0]||(e[0]=l=>B.enabled=l)},null,8,["modelValue"])])]),B.enabled?(b(),c(r,{key:0},[i("div",S,[e[14]||(e[14]=i("div",{class:"section-title"},"应用凭证",-1)),e[15]||(e[15]=i("p",{class:"section-desc"},"在钉钉开放平台创建企业内部应用后获取以下信息",-1)),i("div",A,[i("div",D,[e[10]||(e[10]=i("label",null,"AppKey",-1)),u(s,{modelValue:B.appKey,"onUpdate:modelValue":e[1]||(e[1]=l=>B.appKey=l),placeholder:"企业内部应用的 AppKey"},null,8,["modelValue"])]),i("div",K,[e[11]||(e[11]=i("label",null,"AgentId",-1)),u(s,{modelValue:B.agentId,"onUpdate:modelValue":e[2]||(e[2]=l=>B.agentId=l),placeholder:"应用的 AgentId"},null,8,["modelValue"])]),i("div",j,[e[12]||(e[12]=i("label",null,"AppSecret",-1)),u(s,{modelValue:B.appSecret,"onUpdate:modelValue":e[3]||(e[3]=l=>B.appSecret=l),type:"password","show-password":"",placeholder:"留空保持不变"},null,8,["modelValue"])]),i("div",x,[e[13]||(e[13]=i("label",null,"CorpId",-1)),u(s,{modelValue:B.corpId,"onUpdate:modelValue":e[4]||(e[4]=l=>B.corpId=l),placeholder:"企业的 CorpId"},null,8,["modelValue"])])])]),i("div",F,[e[22]||(e[22]=i("div",{class:"section-title"},"用户匹配",-1)),i("div",C,[i("div",z,[e[16]||(e[16]=i("label",null,"匹配字段",-1)),u(v,{modelValue:B.matchField,"onUpdate:modelValue":e[5]||(e[5]=l=>B.matchField=l),style:{width:"100%"}},{default:p(()=>[u(t,{label:"手机号",value:"mobile"}),u(t,{label:"邮箱",value:"email"}),u(t,{label:"钉钉 UserId",value:"userid"})]),_:1},8,["modelValue"]),e[17]||(e[17]=i("span",{class:"field-hint"},"选择用钉钉用户的哪个字段与系统用户进行匹配",-1))]),i("div",E,[e[19]||(e[19]=i("label",null,"自动注册用户",-1)),i("div",G,[u(a,{modelValue:B.autoRegister,"onUpdate:modelValue":e[6]||(e[6]=l=>B.autoRegister=l)},null,8,["modelValue"]),e[18]||(e[18]=i("span",{class:"switch-hint"},"首次登录的钉钉用户自动创建系统账号",-1))])])]),B.autoRegister?(b(),c("div",M,[i("div",O,[e[20]||(e[20]=i("label",null,"默认角色",-1)),u(v,{modelValue:B.defaultRoleId,"onUpdate:modelValue":e[7]||(e[7]=l=>B.defaultRoleId=l),placeholder:"选择默认角色",style:{width:"100%"}},{default:p(()=>[(b(!0),c(r,null,g(q.value,l=>(b(),V(t,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[21]||(e[21]=i("span",{class:"field-hint"},"自动注册的用户将被分配此角色",-1))])])):m("",!0)])],64)):m("",!0),i("div",P,[u(f,{type:"primary",onClick:H,loading:d.value,size:"large"},{default:p(()=>[...e[23]||(e[23]=[y("保存配置",-1)])]),_:1},8,["loading"])])])}}}),[["__scopeId","data-v-6c15cbbc"]]);export{q as default};
