import{q as e,J as l,E as a,K as d}from"./elementPlus-DW6qdM9Z.js";import{h as t,_ as s}from"./index-D9Oaf6TO.js";import{v as o,k as u,D as r,G as n,U as p,E as m,F as i,r as c,ac as b,y as f,P as y,z as v,S as V,I as h,u as _,R as w,M as T,l as g,ad as k}from"./vendor-DDTA3iPl.js";const U={class:"connectors-page"},q={class:"stat-row"},D={class:"stat-card"},P={class:"stat-value"},x={class:"stat-card stat-success"},S={class:"stat-value"},C={class:"stat-card stat-error"},A={class:"stat-value"},F={class:"card-header-row"},L={class:"conn-name"},O={class:"conn-addr"},N={class:"health-status"},j={class:"addr-row"},z={class:"addr-row"},H=s(o({__name:"Connectors",setup(s){const o=c([]),H=c(!1),Q=c(!1),M=c(!1),B=c(!1),E=c(0),I=c(0),R={mysql:"MySQL",postgresql:"PostgreSQL",oracle:"Oracle",sqlserver:"SQL Server"},G={mysql:3306,postgresql:5432,oracle:1521,sqlserver:1433},J=e=>{if("ldap_ad"===e.type)return"LDAP AD";if("database"===e.type||"mysql"===e.type){const l=e.dbType||(e.type,"mysql");return R[l]||"数据库"}return e.type},K={name:"",type:"ldap_ad",host:"",port:636,backupHost:"",backupPort:389,useTls:!0,baseDn:"",bindDn:"",bindPassword:"",database:"",dbUser:"",dbPassword:"",dbType:"mysql",serviceName:"",charset:"utf8mb4",userTable:"",groupTable:"",roleTable:"",pwdFormat:"bcrypt",timeout:5,upnSuffix:"",userFilter:""},$=e=>{X.port="ldap_ad"===e?X.useTls?636:389:G[X.dbType]||3306},W=e=>{X.port=G[e]||3306,X.charset="mysql"!==e?"":"utf8mb4"},X=g({...K}),Y=async()=>{var e;H.value=!0;try{const l=await t.list();o.value=(null==(e=l.data)?void 0:e.data)||[]}finally{H.value=!1}},Z=e=>{if(Object.assign(X,K),e){B.value=!0,E.value=e.id;const l="mysql"===e.type?"database":e.type,a=e.dbType||(e.type,"mysql");Object.assign(X,{name:e.name,type:l,host:e.host,port:e.port,backupHost:e.backupHost,backupPort:e.backupPort,useTls:e.useTls,baseDn:e.baseDn,bindDn:e.bindDn,bindPassword:"",database:e.database,dbUser:e.dbUser,dbPassword:"",dbType:a,serviceName:e.serviceName||"",charset:e.charset,userTable:e.userTable,groupTable:e.groupTable,roleTable:e.roleTable,pwdFormat:e.pwdFormat,timeout:e.timeout,upnSuffix:e.upnSuffix,userFilter:e.userFilter})}else B.value=!1,E.value=0;M.value=!0},ee=async()=>{if(X.name&&X.host){Q.value=!0;try{B.value?await t.update(E.value,{...X}):await t.create({...X}),a.success("保存成功"),M.value=!1,Y()}finally{Q.value=!1}}else a.warning("请填写必填项")},le=async e=>{try{await d.confirm(`确定删除连接器「${e.name}」？删除后，依赖此连接器的同步器将无法工作。`,"确认删除",{type:"warning"}),await t.delete(e.id),a.success("删除成功"),Y()}catch{}};return u(Y),(d,s)=>{const u=b("el-icon"),c=b("el-button"),g=b("el-table-column"),E=b("el-tag"),R=b("el-tooltip"),G=b("el-dropdown-item"),K=b("el-dropdown-menu"),ae=b("el-dropdown"),de=b("el-empty"),te=b("el-table"),se=b("el-card"),oe=b("el-input"),ue=b("el-form-item"),re=b("el-radio-button"),ne=b("el-radio-group"),pe=b("el-option"),me=b("el-select"),ie=b("el-divider"),ce=b("el-input-number"),be=b("el-switch"),fe=b("el-form"),ye=b("el-dialog"),ve=k("loading");return f(),r("div",U,[n("div",q,[n("div",D,[n("span",P,p(o.value.length),1),s[26]||(s[26]=n("span",{class:"stat-label"},"连接器总数",-1))]),n("div",x,[n("span",S,p(o.value.filter(e=>e.lastTestOk).length),1),s[27]||(s[27]=n("span",{class:"stat-label"},"在线",-1))]),n("div",C,[n("span",A,p(o.value.filter(e=>e.lastTestAt&&!e.lastTestOk).length),1),s[28]||(s[28]=n("span",{class:"stat-label"},"异常",-1))])]),m(se,null,{header:i(()=>[n("div",F,[s[30]||(s[30]=n("span",{class:"card-title"},"连接器管理",-1)),m(c,{type:"primary",onClick:s[0]||(s[0]=e=>Z())},{default:i(()=>[m(u,null,{default:i(()=>[m(_(l))]),_:1}),s[29]||(s[29]=V(" 新增连接器 ",-1))]),_:1})])]),default:i(()=>[y((f(),v(te,{data:o.value,stripe:""},{empty:i(()=>[m(de,{description:"暂无连接器，点击上方按钮新增","image-size":120})]),default:i(()=>[m(g,{prop:"name",label:"名称","min-width":"160"},{default:i(({row:e})=>[n("span",L,p(e.name),1)]),_:1}),m(g,{prop:"type",label:"类型",width:"140",align:"center"},{default:i(({row:e})=>[m(E,{type:"ldap_ad"===e.type?"primary":"success",size:"small",effect:"light"},{default:i(()=>[V(p(J(e)),1)]),_:2},1032,["type"])]),_:1}),m(g,{label:"地址","min-width":"200"},{default:i(({row:e})=>[n("span",O,p(e.host)+":"+p(e.port),1)]),_:1}),m(g,{label:"健康状态",width:"160",align:"center"},{default:i(({row:e})=>[n("div",N,[n("span",{class:h(["health-dot",{online:e.lastTestOk,offline:e.lastTestAt&&!e.lastTestOk}])},null,2),n("span",null,p(e.lastTestOk?"在线":e.lastTestAt?"异常":"未测试"),1),s[31]||(s[31]=n("span",{class:"health-sep"},"·",-1)),n("span",{class:h(1===e.status?"text-success":"text-error")},p(1===e.status?"启用":"禁用"),3)])]),_:1}),m(g,{label:"操作",width:"180",fixed:"right"},{default:i(({row:l})=>[m(R,{content:"测试连接",placement:"top"},{default:i(()=>[m(c,{type:"primary",link:"",size:"small",onClick:e=>(async e=>{var l,d,s,o;I.value=e.id;try{const s=await t.test(e.id);a.success((null==(d=null==(l=s.data)?void 0:l.data)?void 0:d.message)||"连接成功"),Y()}catch(u){a.error((null==(o=null==(s=null==u?void 0:u.response)?void 0:s.data)?void 0:o.message)||"连接失败"),Y()}finally{I.value=0}})(l),loading:I.value===l.id},{default:i(()=>[m(u,null,{default:i(()=>[m(_(e))]),_:1})]),_:1},8,["onClick","loading"])]),_:2},1024),m(c,{type:"primary",link:"",size:"small",onClick:e=>Z(l)},{default:i(()=>[...s[32]||(s[32]=[V("编辑",-1)])]),_:1},8,["onClick"]),m(ae,{trigger:"click",onCommand:e=>((e,l)=>{"delete"===e&&le(l)})(e,l)},{dropdown:i(()=>[m(K,null,{default:i(()=>[m(G,{command:"delete",class:"text-error"},{default:i(()=>[...s[34]||(s[34]=[V("删除",-1)])]),_:1})]),_:1})]),default:i(()=>[m(c,{type:"info",link:"",size:"small"},{default:i(()=>[...s[33]||(s[33]=[V("更多",-1)])]),_:1})]),_:1},8,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ve,H.value]])]),_:1}),m(ye,{modelValue:M.value,"onUpdate:modelValue":s[25]||(s[25]=e=>M.value=e),title:B.value?"编辑连接器":"新增连接器",width:"640px","destroy-on-close":""},{footer:i(()=>[m(c,{onClick:s[24]||(s[24]=e=>M.value=!1)},{default:i(()=>[...s[39]||(s[39]=[V("取消",-1)])]),_:1}),m(c,{type:"primary",onClick:ee,loading:Q.value},{default:i(()=>[...s[40]||(s[40]=[V("保存",-1)])]),_:1},8,["loading"])]),default:i(()=>[m(fe,{model:X,"label-width":"110px"},{default:i(()=>[m(ue,{label:"连接器名称",required:""},{default:i(()=>[m(oe,{modelValue:X.name,"onUpdate:modelValue":s[1]||(s[1]=e=>X.name=e),placeholder:"如：AD域服务器"},null,8,["modelValue"])]),_:1}),m(ue,{label:"类型",required:""},{default:i(()=>[m(ne,{modelValue:X.type,"onUpdate:modelValue":s[2]||(s[2]=e=>X.type=e),disabled:B.value,onChange:$},{default:i(()=>[m(re,{value:"ldap_ad"},{default:i(()=>[...s[35]||(s[35]=[V("LDAP AD",-1)])]),_:1}),m(re,{value:"database"},{default:i(()=>[...s[36]||(s[36]=[V("数据库",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),"database"===X.type?(f(),v(ue,{key:0,label:"数据库类型",required:""},{default:i(()=>[m(me,{modelValue:X.dbType,"onUpdate:modelValue":s[3]||(s[3]=e=>X.dbType=e),class:"full-width",onChange:W,disabled:B.value},{default:i(()=>[m(pe,{label:"MySQL",value:"mysql"}),m(pe,{label:"PostgreSQL",value:"postgresql"}),m(pe,{label:"Oracle",value:"oracle"}),m(pe,{label:"SQL Server",value:"sqlserver"})]),_:1},8,["modelValue","disabled"])]),_:1})):w("",!0),m(ie,{"content-position":"left"},{default:i(()=>[...s[37]||(s[37]=[V("连接参数",-1)])]),_:1}),m(ue,{label:"地址",required:""},{default:i(()=>[n("div",j,[m(oe,{modelValue:X.host,"onUpdate:modelValue":s[4]||(s[4]=e=>X.host=e),placeholder:"服务器地址",class:"addr-host"},null,8,["modelValue"]),m(ce,{modelValue:X.port,"onUpdate:modelValue":s[5]||(s[5]=e=>X.port=e),min:1,max:65535,class:"addr-port"},null,8,["modelValue"])])]),_:1}),"ldap_ad"===X.type?(f(),r(T,{key:1},[m(ue,{label:"备用地址"},{default:i(()=>[n("div",z,[m(oe,{modelValue:X.backupHost,"onUpdate:modelValue":s[6]||(s[6]=e=>X.backupHost=e),placeholder:"备用服务器",class:"addr-host"},null,8,["modelValue"]),m(ce,{modelValue:X.backupPort,"onUpdate:modelValue":s[7]||(s[7]=e=>X.backupPort=e),min:1,max:65535,class:"addr-port"},null,8,["modelValue"])])]),_:1}),m(ue,{label:"LDAPS"},{default:i(()=>[m(be,{modelValue:X.useTls,"onUpdate:modelValue":s[8]||(s[8]=e=>X.useTls=e)},null,8,["modelValue"]),s[38]||(s[38]=n("span",{class:"field-hint"},"AD密码同步必须启用LDAPS",-1))]),_:1}),m(ue,{label:"Base DN",required:""},{default:i(()=>[m(oe,{modelValue:X.baseDn,"onUpdate:modelValue":s[9]||(s[9]=e=>X.baseDn=e),placeholder:"dc=example,dc=com"},null,8,["modelValue"])]),_:1}),m(ue,{label:"Bind DN",required:""},{default:i(()=>[m(oe,{modelValue:X.bindDn,"onUpdate:modelValue":s[10]||(s[10]=e=>X.bindDn=e),placeholder:"cn=administrator,cn=users,dc=example,dc=com"},null,8,["modelValue"])]),_:1}),m(ue,{label:"密码",required:""},{default:i(()=>[m(oe,{modelValue:X.bindPassword,"onUpdate:modelValue":s[11]||(s[11]=e=>X.bindPassword=e),type:"password","show-password":"",placeholder:B.value?"留空不修改":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),m(ue,{label:"UPN后缀"},{default:i(()=>[m(oe,{modelValue:X.upnSuffix,"onUpdate:modelValue":s[12]||(s[12]=e=>X.upnSuffix=e),placeholder:"@example.com"},null,8,["modelValue"])]),_:1}),m(ue,{label:"用户过滤"},{default:i(()=>[m(oe,{modelValue:X.userFilter,"onUpdate:modelValue":s[13]||(s[13]=e=>X.userFilter=e),placeholder:"(&(objectClass=user)(objectCategory=person))"},null,8,["modelValue"])]),_:1})],64)):w("",!0),"database"===X.type?(f(),r(T,{key:2},[m(ue,{label:"oracle"===X.dbType?"服务名":"数据库名",required:""},{default:i(()=>[m(oe,{modelValue:X.database,"onUpdate:modelValue":s[14]||(s[14]=e=>X.database=e),placeholder:"oracle"===X.dbType?"ORCL":"数据库名"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),"oracle"===X.dbType?(f(),v(ue,{key:0,label:"Service Name"},{default:i(()=>[m(oe,{modelValue:X.serviceName,"onUpdate:modelValue":s[15]||(s[15]=e=>X.serviceName=e),placeholder:"Oracle Service Name（可选，默认取数据库名）"},null,8,["modelValue"])]),_:1})):w("",!0),m(ue,{label:"用户名",required:""},{default:i(()=>[m(oe,{modelValue:X.dbUser,"onUpdate:modelValue":s[16]||(s[16]=e=>X.dbUser=e),placeholder:"数据库用户名"},null,8,["modelValue"])]),_:1}),m(ue,{label:"密码",required:""},{default:i(()=>[m(oe,{modelValue:X.dbPassword,"onUpdate:modelValue":s[17]||(s[17]=e=>X.dbPassword=e),type:"password","show-password":"",placeholder:B.value?"留空不修改":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),"mysql"===X.dbType?(f(),v(ue,{key:1,label:"字符集"},{default:i(()=>[m(oe,{modelValue:X.charset,"onUpdate:modelValue":s[18]||(s[18]=e=>X.charset=e),placeholder:"utf8mb4"},null,8,["modelValue"])]),_:1})):w("",!0),m(ue,{label:"用户表名"},{default:i(()=>[m(oe,{modelValue:X.userTable,"onUpdate:modelValue":s[19]||(s[19]=e=>X.userTable=e),placeholder:"如: users"},null,8,["modelValue"])]),_:1}),m(ue,{label:"分组表名"},{default:i(()=>[m(oe,{modelValue:X.groupTable,"onUpdate:modelValue":s[20]||(s[20]=e=>X.groupTable=e),placeholder:"如: departments"},null,8,["modelValue"])]),_:1}),m(ue,{label:"角色表名"},{default:i(()=>[m(oe,{modelValue:X.roleTable,"onUpdate:modelValue":s[21]||(s[21]=e=>X.roleTable=e),placeholder:"如: roles"},null,8,["modelValue"])]),_:1}),m(ue,{label:"密码格式"},{default:i(()=>[m(me,{modelValue:X.pwdFormat,"onUpdate:modelValue":s[22]||(s[22]=e=>X.pwdFormat=e),class:"full-width"},{default:i(()=>[m(pe,{label:"bcrypt",value:"bcrypt"}),m(pe,{label:"MD5",value:"md5"}),m(pe,{label:"SHA256",value:"sha256"}),m(pe,{label:"明文",value:"plain"})]),_:1},8,["modelValue"])]),_:1})],64)):w("",!0),m(ue,{label:"超时(秒)"},{default:i(()=>[m(ce,{modelValue:X.timeout,"onUpdate:modelValue":s[23]||(s[23]=e=>X.timeout=e),min:1,max:60},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-ca4394e1"]]);export{H as default};
