import{v as e,r as s,j as l,k as a,D as t,H as i,G as n,P as o,V as d,U as r,E as u,u as m,M as c,a6 as p,F as v,R as h,I as g,c as f,ac as y,y as w,z as b,Q as k,$ as _,S as P,aC as V,aD as x,l as C,aB as S}from"./vendor-DDTA3iPl.js";import{s as I,b as U,c as A,f as j,e as E,d as T,u as z,g as D,E as M,h as B,j as J,r as L,k as N,t as O,m as $,l as F}from"./elementPlus-DW6qdM9Z.js";import{u as G,s as H,a as Q,_ as R}from"./index-D9Oaf6TO.js";const q={class:"sidebar-header"},K={class:"logo"},W={class:"menu-search"},X={class:"menu-nav"},Y=["onClick"],Z={key:0,class:"submenu"},ee=["onClick"],se={class:"menu-title"},le={class:"sidebar-footer"},ae={class:"main-container"},te={key:0,class:"topbar"},ie={class:"topbar-left"},ne={class:"topbar-right"},oe={class:"global-search"},de={class:"user-dropdown"},re={key:0,class:"user-info"},ue={class:"user-name"},me={class:"content-area"},ce=R(e({__name:"MainLayout",setup(e){const R=x(),ce=S(),pe=G(),ve=s("true"===localStorage.getItem("sidebarCollapsed")),he=s(""),ge=s(""),fe=s(0),ye=s({browserTitle:"",loginTitle:""}),we=s(!1),be=C({oldPassword:"",newPassword:"",confirmPassword:""}),ke=[{id:"home",title:"ç³»ç»Ÿé¦–é¡µ",icon:B,path:"/admin",level:1,order:0,permission:["settings:system"]},{id:"user-source",title:"ç”¨æˆ·ç®¡ç†",icon:J,level:1,order:1,permission:["user:list"],children:[{id:"local-users",title:"ç”¨æˆ·",path:"/admin/users/local",level:2,permission:"user:list"}]},{id:"sync-mgmt",title:"åŒæ­¥ç®¡ç†",icon:L,level:1,order:2,permission:["settings:system"],children:[{id:"upstream-sync",title:"ä¸Šæ¸¸åŒæ­¥",path:"/admin/sync/upstream",level:2,permission:"settings:system"},{id:"downstream-sync",title:"ä¸‹æ¸¸åŒæ­¥",path:"/admin/sync/downstream",level:2,permission:"settings:system"}]},{id:"roles",title:"è§’è‰²ç®¡ç†",icon:N,path:"/admin/roles",level:1,order:3,permission:["role:list"]},{id:"logs",title:"æ—¥å¿—ç®¡ç†",icon:O,level:1,order:4,permission:["log:login","log:operation","settings:system"],children:[{id:"system-logs",title:"ç³»ç»Ÿæ—¥å¿—",path:"/admin/logs/system",level:2,permission:"log:login"},{id:"sync-logs",title:"åŒæ­¥æ—¥å¿—",path:"/admin/logs/sync",level:2,permission:"log:operation"},{id:"api-logs",title:"APIè°ƒç”¨æ—¥å¿—",path:"/admin/logs/api",level:2,permission:"settings:system"},{id:"log-settings",title:"æ—¥å¿—è®¾ç½®",path:"/admin/logs/settings",level:2,permission:"settings:system"}]},{id:"notify",title:"é€šçŸ¥ç®¡ç†",icon:T,level:1,order:5,permission:["settings:system"],children:[{id:"channels",title:"é€šçŸ¥æ¸ é“",path:"/admin/notify/channels",level:2,permission:"settings:system"},{id:"msg-templates",title:"æ¶ˆæ¯æ¨¡æ¿",path:"/admin/notify/templates",level:2,permission:"settings:system"},{id:"alert-rules",title:"è§„åˆ™ä¸ç­–ç•¥",path:"/admin/notify/rules",level:2,permission:"settings:system"}]},{id:"settings",title:"ç³»ç»Ÿè®¾ç½®",icon:$,level:1,order:6,permission:["settings:system"],children:[{id:"settings-ui",title:"ç•Œé¢ä¸è¯ä¹¦",path:"/admin/settings",level:2,permission:"settings:system"},{id:"settings-ldap",title:"LDAP æœåŠ¡",path:"/admin/settings/ldap",level:2,permission:"settings:system"},{id:"settings-apikeys",title:"API å¯†é’¥",path:"/admin/apikeys",level:2,permission:"settings:system"}]},{id:"security",title:"å®‰å…¨ä¸­å¿ƒ",icon:F,path:"/admin/security",level:1,order:7,permission:["settings:system"]}],_e=s(new Set(["user-source"])),Pe=e=>_e.value.has(e),Ve=e=>{_e.value.has(e)?_e.value.delete(e):_e.value.add(e),localStorage.setItem("menuExpandState",JSON.stringify([..._e.value]))},xe=f(()=>{var e;const s=(null==(e=pe.layoutConfig)?void 0:e.sidebarMode)||"auto";if("hidden"===s)return!1;if("visible"===s)return!0;return Ce.value.filter(e=>!!e.permission).length>1}),Ce=f(()=>ke.map(e=>{if(e.permission){if(!(Array.isArray(e.permission)?e.permission:[e.permission]).some(e=>pe.hasPermission(e)))return null}let s=e.children;return s&&(s=s.filter(e=>!(e.permission&&!pe.hasPermission(e.permission)))),{...e,children:s}}).filter(Boolean)),Se=f(()=>{const e=R.path,s=[];for(const l of ke){if(l.path===e){s.push({path:l.path,title:l.title});break}if(l.children){const a=l.children.find(s=>s.path===e);if(a){s.push({path:"",title:l.title}),s.push({path:a.path||"",title:a.title});break}}}return s}),Ie=e=>{var s;return e.path===R.path||!!(null==(s=e.children)?void 0:s.some(e=>e.path===R.path))},Ue=()=>{ve.value=!ve.value,localStorage.setItem("sidebarCollapsed",String(ve.value))},Ae=async e=>{"logout"===e?(await pe.logout(),ce.push("/login")):("password"===e||"profile"===e)&&ce.push("/admin/profile")},je=async()=>{if(be.oldPassword&&be.newPassword)if(be.newPassword===be.confirmPassword)try{(await Q.changePassword({oldPassword:be.oldPassword,newPassword:be.newPassword})).data.success&&(M.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),we.value=!1)}catch(e){}else M.warning("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´");else M.warning("è¯·å¡«å†™å®Œæ•´")};return l(()=>R.path,e=>{ke.forEach(s=>{var l;(null==(l=s.children)?void 0:l.some(s=>s.path===e))&&_e.value.add(s.id)})},{immediate:!0}),a(async()=>{(()=>{const e=localStorage.getItem("menuExpandState");if(e)try{const s=JSON.parse(e);Array.isArray(s)&&(_e.value=new Set(s))}catch(s){}})();try{const e=await H.getUI();e.data.success&&(ye.value=e.data.data,ye.value.browserTitle&&(document.title=ye.value.browserTitle))}catch(e){}}),(e,s)=>{const l=y("el-input"),a=y("el-icon"),f=y("el-breadcrumb-item"),x=y("el-breadcrumb"),C=y("el-button"),S=y("el-badge"),M=y("el-avatar"),B=y("el-dropdown-item"),J=y("el-dropdown-menu"),L=y("el-dropdown"),N=y("router-view"),O=y("el-form-item"),$=y("el-form"),F=y("el-dialog");return w(),t("div",{class:g(["admin-layout",{"sidebar-collapsed":ve.value,"no-sidebar":!xe.value}])},[xe.value?(w(),t("aside",{key:0,class:"sidebar",style:i({width:ve.value?"64px":"220px"})},[n("div",q,[n("div",K,[s[7]||(s[7]=n("span",{class:"logo-icon"},"ğŸ›¡ï¸",-1)),o(n("span",{class:"logo-text"},r(ye.value.browserTitle||"ç”¨æˆ·ç®¡ç†"),513),[[d,!ve.value]])])]),o(n("div",W,[u(l,{modelValue:he.value,"onUpdate:modelValue":s[0]||(s[0]=e=>he.value=e),placeholder:"æœç´¢èœå•...","prefix-icon":m(I),size:"small",clearable:""},null,8,["modelValue","prefix-icon"])],512),[[d,!ve.value]]),n("nav",X,[(w(!0),t(c,null,p(Ce.value,e=>{var s,l,i;return w(),t(c,{key:e.id},[n("div",{class:g(["menu-item level-1",{active:Ie(e),expanded:Pe(e.id),"has-children":null==(s=e.children)?void 0:s.length}]),onClick:s=>(e=>{var s;(null==(s=e.children)?void 0:s.length)?Ve(e.id):e.path&&ce.push(e.path)})(e)},[u(a,{class:"menu-icon"},{default:v(()=>[(w(),b(k(e.icon)))]),_:2},1024),o(n("span",{class:"menu-title"},r(e.title),513),[[d,!ve.value]]),(null==(l=e.children)?void 0:l.length)&&!ve.value?(w(),b(a,{key:0,class:"expand-icon"},{default:v(()=>[Pe(e.id)?(w(),b(m(U),{key:0})):(w(),b(m(A),{key:1}))]),_:2},1024)):h("",!0)],10,Y),(null==(i=e.children)?void 0:i.length)&&!ve.value?o((w(),t("div",Z,[(w(!0),t(c,null,p(e.children,e=>(w(),t("div",{key:e.id,class:g(["menu-item level-2",{active:m(R).path===e.path}]),onClick:_(s=>{var l;(l=e.path)&&ce.push(l)},["stop"])},[n("span",se,r(e.title),1)],10,ee))),128))],512)),[[d,Pe(e.id)]]):h("",!0)],64)}),128))]),n("div",le,[n("div",{class:"collapse-btn",onClick:Ue},[u(a,null,{default:v(()=>[ve.value?(w(),b(m(E),{key:1})):(w(),b(m(j),{key:0}))]),_:1}),o(n("span",null,"æ”¶èµ·èœå•",512),[[d,!ve.value]])])])],4)):h("",!0),n("div",ae,[xe.value?(w(),t("header",te,[n("div",ie,[u(x,{separator:"/"},{default:v(()=>[u(f,{to:{path:"/admin"}},{default:v(()=>[...s[8]||(s[8]=[P("ç®¡ç†åå°",-1)])]),_:1}),(w(!0),t(c,null,p(Se.value,e=>(w(),b(f,{key:e.path},{default:v(()=>[P(r(e.title),1)]),_:2},1024))),128))]),_:1})]),n("div",ne,[n("div",oe,[u(l,{modelValue:ge.value,"onUpdate:modelValue":s[1]||(s[1]=e=>ge.value=e),placeholder:"æœç´¢...","prefix-icon":m(I),size:"default",style:{width:"200px"},clearable:""},null,8,["modelValue","prefix-icon"])]),u(S,{value:fe.value,hidden:0===fe.value,class:"notification-badge"},{default:v(()=>[u(C,{icon:m(T),circle:""},null,8,["icon"])]),_:1},8,["value","hidden"]),u(L,{onCommand:Ae,trigger:"click"},{dropdown:v(()=>[u(J,null,{default:v(()=>[u(B,{command:"profile"},{default:v(()=>[u(a,null,{default:v(()=>[u(m(z))]),_:1}),s[9]||(s[9]=P(" ä¸ªäººä¸­å¿ƒ ",-1))]),_:1}),u(B,{divided:"",command:"logout"},{default:v(()=>[u(a,null,{default:v(()=>[u(m(D))]),_:1}),s[10]||(s[10]=P(" é€€å‡ºç™»å½• ",-1))]),_:1})]),_:1})]),default:v(()=>{var e,s;return[n("div",de,[u(M,{size:36,class:"user-avatar"},{default:v(()=>{var e,s;return[P(r((null==(s=null==(e=m(pe).user)?void 0:e.nickname)?void 0:s.charAt(0))||"U"),1)]}),_:1}),ve.value?h("",!0):(w(),t("div",re,[n("span",ue,r((null==(e=m(pe).user)?void 0:e.nickname)||(null==(s=m(pe).user)?void 0:s.username)),1)])),u(a,null,{default:v(()=>[u(m(U))]),_:1})])]}),_:1})])])):h("",!0),n("main",me,[u(N,null,{default:v(({Component:s})=>[(w(),b(V,{max:10},[(w(),b(k(s),{key:e.$route.path}))],1024))]),_:1})])]),u(F,{modelValue:we.value,"onUpdate:modelValue":s[6]||(s[6]=e=>we.value=e),title:"ä¿®æ”¹å¯†ç ",width:"420px","close-on-click-modal":!1},{footer:v(()=>[u(C,{onClick:s[5]||(s[5]=e=>we.value=!1)},{default:v(()=>[...s[11]||(s[11]=[P("å–æ¶ˆ",-1)])]),_:1}),u(C,{type:"primary",onClick:je},{default:v(()=>[...s[12]||(s[12]=[P("ç¡®å®š",-1)])]),_:1})]),default:v(()=>[u($,{model:be,"label-width":"80px"},{default:v(()=>[u(O,{label:"åŸå¯†ç "},{default:v(()=>[u(l,{modelValue:be.oldPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>be.oldPassword=e),type:"password","show-password":"",placeholder:"è¯·è¾“å…¥åŸå¯†ç "},null,8,["modelValue"])]),_:1}),u(O,{label:"æ–°å¯†ç "},{default:v(()=>[u(l,{modelValue:be.newPassword,"onUpdate:modelValue":s[3]||(s[3]=e=>be.newPassword=e),type:"password","show-password":"",placeholder:"è¯·è¾“å…¥æ–°å¯†ç "},null,8,["modelValue"])]),_:1}),u(O,{label:"ç¡®è®¤å¯†ç "},{default:v(()=>[u(l,{modelValue:be.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=e=>be.confirmPassword=e),type:"password","show-password":"",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],2)}}}),[["__scopeId","data-v-3d45662a"]]);export{ce as default};
