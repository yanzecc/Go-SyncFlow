import{N as e,H as a,E as l,K as t}from"./elementPlus-DW6qdM9Z.js";import{s as o,f as s,_ as d}from"./index-D9Oaf6TO.js";import{v as n,k as c,D as r,E as u,F as i,r as p,ac as f,l as m,y,G as v,S as g,U as _,R as h,z as b,M as w,a6 as T,Q as k,u as S}from"./vendor-DDTA3iPl.js";const x={class:"settings-page"},V={class:"card-header"},U={key:0,class:"cert-status"},C={class:"cert-info"},P={key:1,class:"cert-status"},E={key:0,class:"form-tip"},L={class:"upload-wrapper"},I={class:"upload-wrapper"},H={class:"docs-grid"},R={class:"doc-card-body"},j={class:"doc-icon"},$={class:"doc-info"},z={class:"doc-name"},A={class:"doc-description"},D={class:"doc-filename"},N={class:"doc-action"},O=d(n({__name:"Settings",setup(d){const n=p("ui"),O=p(!1),F=p(!1),B=p(!1),G=p(!1),M=m({browserTitle:"",loginTitle:"",logo:"",footerShortName:"",footerCompany:"",footerICP:""}),K=m({enabled:!1,port:"8443",domain:"",certExpiry:"",certSubject:"",certExists:!1,keyExists:!1}),Q=p(null),q=p(null),J=p(),W=p(),X=async()=>{O.value=!0;try{await o.updateUI(M),l.success("保存成功"),M.browserTitle&&(document.title=M.browserTitle)}finally{O.value=!1}},Y=async()=>{try{const e=await o.getHttps();e.data.success&&e.data.data&&Object.assign(K,e.data.data)}catch(e){}},Z=async()=>{F.value=!0;try{await o.updateHttps({enabled:K.enabled,port:K.port}),l.success("保存成功，重启服务后生效")}finally{F.value=!1}},ee=async()=>{var e,a,t,s;if(Q.value&&q.value){B.value=!0;try{const t=new FormData;t.append("cert",Q.value),t.append("key",q.value);const s=await o.uploadCert(t);s.data.success?(l.success("证书上传成功"),null==(e=J.value)||e.clearFiles(),null==(a=W.value)||a.clearFiles(),Q.value=null,q.value=null,await Y()):l.error(s.data.message||"证书上传失败")}catch(d){const e=(null==(s=null==(t=null==d?void 0:d.response)?void 0:t.data)?void 0:s.message)||"证书上传失败";l.error(e)}finally{B.value=!1}}else l.warning("请选择证书文件和私钥文件")},ae=async()=>{try{await t.confirm("确定要删除SSL证书吗？删除后HTTPS将无法使用。","确认删除",{type:"warning"}),G.value=!0;(await o.deleteCert()).data.success&&(l.success("证书已删除"),await Y())}catch(e){}finally{G.value=!1}},le=e=>{if(!e)return"未知";try{const a=new Date(e),l=new Date,t=a.getTime()-l.getTime(),o=Math.floor(t/864e5),s=a.toLocaleDateString("zh-CN");return o<0?`${s} (已过期)`:o<30?`${s} (剩余 ${o} 天)`:s}catch{return e}},te=p([]);return c(()=>{(async()=>{try{const e=await o.getUI();e.data.success&&Object.assign(M,e.data.data)}catch(e){}})(),Y(),(async()=>{var e;try{const a=await s.get("/docs");(null==(e=a.data)?void 0:e.success)&&(te.value=a.data.data||[])}catch{te.value=[{id:"technical",name:"技术架构文档",description:"系统功能说明、代码结构、数据库设计和服务依赖需求",filename:"技术架构文档.pdf",icon:"Setting"},{id:"manual",name:"系统使用手册",description:"所有功能模块的操作指南和使用示例说明",filename:"系统使用手册.pdf",icon:"Document"},{id:"api",name:"API接口文档",description:"完整的REST API调用文档，含示例和错误码",filename:"API接口文档.pdf",icon:"Connection"}]}})()}),(t,o)=>{const s=f("el-input"),d=f("el-form-item"),c=f("el-col"),p=f("el-row"),m=f("el-form"),Y=f("el-card"),oe=f("el-button"),se=f("el-tab-pane"),de=f("el-tag"),ne=f("el-alert"),ce=f("el-divider"),re=f("el-switch"),ue=f("el-upload"),ie=f("el-icon"),pe=f("el-tabs");return y(),r("div",x,[u(pe,{modelValue:n.value,"onUpdate:modelValue":o[8]||(o[8]=e=>n.value=e),type:"border-card"},{default:i(()=>[u(se,{label:"界面配置",name:"ui"},{default:i(()=>[u(Y,{class:"config-card"},{header:i(()=>[...o[9]||(o[9]=[v("span",null,"基本信息",-1)])]),default:i(()=>[u(m,{model:M,"label-width":"120px",class:"config-form"},{default:i(()=>[u(p,{gutter:24},{default:i(()=>[u(c,{span:12},{default:i(()=>[u(d,{label:"浏览器标题"},{default:i(()=>[u(s,{modelValue:M.browserTitle,"onUpdate:modelValue":o[0]||(o[0]=e=>M.browserTitle=e),placeholder:"能耗管理中心"},null,8,["modelValue"])]),_:1})]),_:1}),u(c,{span:12},{default:i(()=>[u(d,{label:"登录页标题"},{default:i(()=>[u(s,{modelValue:M.loginTitle,"onUpdate:modelValue":o[1]||(o[1]=e=>M.loginTitle=e),placeholder:"能耗管理系统"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(d,{label:"Logo URL"},{default:i(()=>[u(s,{modelValue:M.logo,"onUpdate:modelValue":o[2]||(o[2]=e=>M.logo=e),placeholder:"可选，留空使用默认Logo"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),u(Y,{class:"config-card"},{header:i(()=>[...o[10]||(o[10]=[v("span",null,"页脚配置",-1)])]),default:i(()=>[u(m,{model:M,"label-width":"120px",class:"config-form"},{default:i(()=>[u(p,{gutter:24},{default:i(()=>[u(c,{span:12},{default:i(()=>[u(d,{label:"公司简称"},{default:i(()=>[u(s,{modelValue:M.footerShortName,"onUpdate:modelValue":o[3]||(o[3]=e=>M.footerShortName=e),placeholder:"如：xxGroup"},null,8,["modelValue"])]),_:1})]),_:1}),u(c,{span:12},{default:i(()=>[u(d,{label:"公司名称"},{default:i(()=>[u(s,{modelValue:M.footerCompany,"onUpdate:modelValue":o[4]||(o[4]=e=>M.footerCompany=e),placeholder:"如：xx科技有限公司"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(d,{label:"ICP备案号"},{default:i(()=>[u(s,{modelValue:M.footerICP,"onUpdate:modelValue":o[5]||(o[5]=e=>M.footerICP=e),placeholder:"如：浙ICP备xxxxxxxx号"},null,8,["modelValue"])]),_:1}),u(d,null,{default:i(()=>[u(oe,{type:"primary",onClick:X,loading:O.value},{default:i(()=>[...o[11]||(o[11]=[g("保存配置",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),u(se,{label:"HTTPS证书",name:"https"},{default:i(()=>[u(Y,{class:"config-card"},{header:i(()=>[v("div",V,[o[12]||(o[12]=v("span",null,"SSL/TLS证书配置",-1)),u(de,{type:K.enabled?"success":"info",size:"small"},{default:i(()=>[g(_(K.enabled?"HTTPS已启用":"HTTPS未启用"),1)]),_:1},8,["type"])])]),default:i(()=>[K.certExists&&K.keyExists?(y(),r("div",U,[u(ne,{type:"success",closable:!1,"show-icon":""},{title:i(()=>[...o[13]||(o[13]=[g("证书已上传",-1)])]),default:i(()=>[v("div",C,[v("p",null,[o[14]||(o[14]=v("strong",null,"域名：",-1)),g(_(K.domain||"未知"),1)]),v("p",null,[o[15]||(o[15]=v("strong",null,"过期时间：",-1)),g(_(le(K.certExpiry)),1)]),v("p",null,[o[16]||(o[16]=v("strong",null,"证书主题：",-1)),g(_(K.certSubject||"未知"),1)])])]),_:1})])):(y(),r("div",P,[u(ne,{type:"warning",closable:!1,"show-icon":""},{title:i(()=>[...o[17]||(o[17]=[g("未上传证书",-1)])]),default:i(()=>[...o[18]||(o[18]=[g("请上传SSL证书和私钥文件以启用HTTPS",-1)])]),_:1})])),u(ce),u(m,{model:K,"label-width":"120px",class:"config-form"},{default:i(()=>[u(p,{gutter:24},{default:i(()=>[u(c,{span:12},{default:i(()=>[u(d,{label:"启用HTTPS"},{default:i(()=>[u(re,{modelValue:K.enabled,"onUpdate:modelValue":o[6]||(o[6]=e=>K.enabled=e),disabled:!K.certExists||!K.keyExists},null,8,["modelValue","disabled"]),K.certExists?h("",!0):(y(),r("div",E,"请先上传证书"))]),_:1})]),_:1}),u(c,{span:12},{default:i(()=>[u(d,{label:"HTTPS端口"},{default:i(()=>[u(s,{modelValue:K.port,"onUpdate:modelValue":o[7]||(o[7]=e=>K.port=e),placeholder:"8443"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(d,null,{default:i(()=>[u(oe,{type:"primary",onClick:Z,loading:F.value},{default:i(()=>[...o[19]||(o[19]=[g("保存配置",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),u(Y,{class:"config-card"},{header:i(()=>[...o[20]||(o[20]=[v("span",null,"上传证书",-1)])]),default:i(()=>[u(m,{"label-width":"120px",class:"config-form"},{default:i(()=>[u(p,{gutter:24},{default:i(()=>[u(c,{span:12},{default:i(()=>[u(d,{label:"证书文件"},{default:i(()=>[v("div",L,[u(ue,{ref_key:"certUploadRef",ref:J,"auto-upload":!1,limit:1,"on-change":e=>Q.value=e.raw,"on-remove":()=>Q.value=null,accept:".crt,.pem,.cer"},{trigger:i(()=>[u(oe,{type:"primary"},{default:i(()=>[...o[21]||(o[21]=[g("选择证书",-1)])]),_:1})]),_:1},8,["on-change","on-remove"]),o[22]||(o[22]=v("span",{class:"upload-format"},".crt, .pem, .cer",-1))])]),_:1})]),_:1}),u(c,{span:12},{default:i(()=>[u(d,{label:"私钥文件"},{default:i(()=>[v("div",I,[u(ue,{ref_key:"keyUploadRef",ref:W,"auto-upload":!1,limit:1,"on-change":e=>q.value=e.raw,"on-remove":()=>q.value=null,accept:".key,.pem"},{trigger:i(()=>[u(oe,{type:"primary"},{default:i(()=>[...o[23]||(o[23]=[g("选择私钥",-1)])]),_:1})]),_:1},8,["on-change","on-remove"]),o[24]||(o[24]=v("span",{class:"upload-format"},".key, .pem",-1))])]),_:1})]),_:1})]),_:1}),u(d,null,{default:i(()=>[u(oe,{type:"success",onClick:ee,loading:B.value,disabled:!Q.value||!q.value},{default:i(()=>[...o[25]||(o[25]=[g(" 上传证书 ",-1)])]),_:1},8,["loading","disabled"]),K.certExists?(y(),b(oe,{key:0,type:"danger",onClick:ae,loading:G.value},{default:i(()=>[...o[26]||(o[26]=[g(" 删除证书 ",-1)])]),_:1},8,["loading"])):h("",!0)]),_:1})]),_:1}),u(ce),o[27]||(o[27]=v("div",{class:"help-content"},[v("h4",null,"配置说明"),v("ol",null,[v("li",null,"准备SSL证书文件（.crt/.pem）和私钥文件（.key/.pem）"),v("li",null,"上传证书和私钥文件"),v("li",null,"配置HTTPS端口（默认8443）"),v("li",null,"启用HTTPS并保存配置"),v("li",null,"重启服务后HTTPS生效")])],-1))]),_:1})]),_:1}),u(se,{label:"文档",name:"docs"},{default:i(()=>[o[30]||(o[30]=v("div",{class:"docs-header"},[v("p",{class:"docs-desc"},"可以下载本系统的所有相关文档，包括API文档、系统文档、帮助文档")],-1)),v("div",H,[(y(!0),r(w,null,T(te.value,t=>(y(),b(Y,{key:t.id,class:"doc-card",shadow:"hover"},{default:i(()=>[v("div",R,[v("div",j,[u(ie,{size:36,style:{color:"var(--color-primary)"}},{default:i(()=>[(y(),b(k(t.icon)))]),_:2},1024)]),v("div",$,[v("h3",z,_(t.name),1),v("p",A,_(t.description),1),v("p",D,_(t.filename),1)]),v("div",N,[u(oe,{type:"primary",onClick:e=>(async e=>{try{const a=await fetch(`/api/docs/${e}?mode=preview`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("预览失败");const l=await a.blob(),t=URL.createObjectURL(l);window.open(t,"_blank")}catch{l.error("文档预览失败，请确认已登录")}})(t.id)},{default:i(()=>[u(ie,null,{default:i(()=>[u(S(e))]),_:1}),o[28]||(o[28]=g("预览 ",-1))]),_:1},8,["onClick"]),u(oe,{onClick:e=>(async(e,a)=>{try{const t=await fetch(`/api/docs/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("下载失败");const o=await t.blob(),s=URL.createObjectURL(o),d=document.createElement("a");d.href=s,d.download=a,d.click(),URL.revokeObjectURL(s),l.success("下载成功 "+a)}catch{l.error("文档下载失败，请确认已登录")}})(t.id,t.filename)},{default:i(()=>[u(ie,null,{default:i(()=>[u(S(a))]),_:1}),o[29]||(o[29]=g("下载 ",-1))]),_:1},8,["onClick"])])])]),_:2},1024))),128))])]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-78e84a4c"]]);export{O as default};
